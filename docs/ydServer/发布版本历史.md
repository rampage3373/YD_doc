引言
==

为发布易达系统各个版本的新增功能和重要缺陷的修复情况，供期货公司客户选择运行版本，特编制易达交易系统版本说明书。

下面列举了含有重要升级内容的易达版本中，次要改进的版本没有列出。

功能和缺陷修复清单
=========

**1.68.9.0**

*   将与合约有关的内存数据的初始空间扩大一倍，从8192调整为16384

**1.68.8.0**

*   修复了ydClient中的一些中文翻译问题

**1.68.6.0**

*   ydApi中增加了自动组合大商所组合保证金的方法

**1.68.4.0**

*   修复了AccountInfo在notifyFinishedInit时数据没有准备好的问题

**1.68.3.0**

*   修复了AccountInfo在notifyFinishedInit时数据没有准备好的问题

**1.68.2.0**

*   修复了在某些情况下导致报单没有被正确发送到交易所的问题

**1.68.1.0**

*   修复了UDP线程在某些情况下陷入死循环的问题

**1.68.0.0**

*   如果在ydApi中传入空字符串或者空指针，那么ydApi会使用在config.txt中定义的AppID和AuthCode

**1.66.0.0**

*   易达会检查调整资金后资金是否充足，如果可用不足则不允许调整

**1.63.0.0**

*   修复了ydAPI中可能不正确绑定CPU的问题
*   在ydAPI的ydUtil.h中增加了getYDNanoTimestamp方法以帮助客户用精确的方式来打时间戳

**1.60.0.0**

*   支持大商所期权组合保证金。易达不会在平仓时检查资金，因此易达在SystemParam中提供了一个开关，由期货公司自行决定是否打开该功能

**1.59.0.0**

*   增加可以单独设置的期权保证金，复用原有期货的字段保存期权空头保证金率

**1.57.0.0**

*   更新ydAPI的样例文件
*   ydDataType.h中的YD\_CPT\_DCE\_OptionCovered改为YD\_CPT\_DCE\_SellOptionCovered
*   ydAPI中增加大量注释，方便投资者开发

**1.55.0.0**

*   修复了api在某些情况下发单延时增加的问题

**1.52.0.0（支持协议报单）**

*   支持协议报单和撤单，详情请参见官网相关文档
*   ydSync可以支持thostriskapi 6.5.0
*   可以在config/BackupFronts中指定应急前置

**1.51.0.0**

*   在inputFlow中增加毫秒级别的时间戳
*   ydClient可以接收config文件作为参数，默认使用YDConfig.ini
*   修改期权保证金计算方式，YDMarginRate中增加期权的保证金率字段

**1.33.0.0**

*   当最新价LastPrice不可用时，使用昨结算价计算持仓盈亏

**1.31.0.0**

*   修复检查早期api的版本时的问题
*   当设置ydConfig.ini中的MonitorReportInterval超过60000时，系统将调整为60000
*   日志中增加用户登陆错误时的错误码

**1.29.0.0**

*   修复了日志中客户端mac地址显示错误的问题
*   修复了穿透式监管报告中，正文部分出现@时需要用&at替换的问题
*   ydApi的YDExtendedPosition增加getYDPosition()，用于获取昨持仓
*   修改期权的昨保证金计算的方法和今保证金一致
*   ydApi的配置文件中现在可以配置AppID和AuthCode作为api的默认值，当api中传入NULL时使用配置文件中的默认值，否则使用传入的值

**1.27.0.0**

*   ydApi的YDExtendedPosition增加CloseProfit和OtherCloseProfit
*   解决了Windows在某些硬件环境中取不到硬盘信息的问题

**1.25.0.0**

*   在ydConfig.ini中增加MaxApiVersion，并增加新的错误类型YD\_ERROR\_TooHighApiVersion
*   在ydClient中会显示过高版本的错误

**1.23.0.0**

*   修改YD\_HF\_MarketMaker为YD\_HF\_Internal，避免用户误解

**1.22.0.0**

*   支持大商所新的组合类型：期权对锁、买入垂直价差、卖出垂直价差、买入期权期货
*   在smokeTest启动模式下，允许设置交易权限和出入金
*   出入金错误时提供更加详细的信息，增加新的错误YD\_ERROR\_InvalidAlterMoneyField

**1.20.0.0**

*   改变报警级别，Error改为Fatal，原来的Warning重新划分为Warning和Error，Fatal表示系统无法继续正常运行，会错误退出，Error表示现在或将来会导致所有客户的交易出现问题，但系统仍然可以继续运行，Warning表示可能会导致部分客户无法交易

**1.19.0.0**

*   支持部分管理端功能

**1.18.0.8**

*   修复某些情况下发送错误顺序的OrderLocalID到交易所的问题
*   修复当前版本发送询价单导致系统卡死的问题
*   修复fixed订单长时间等待的问题
*   修复大商所在非管理席位模式下无法正常运行的问题

**1.18.0.1**

*   ydServer忽略不支持的组合合约，避免产生大量错误信息
*   ydApi支持采集nvme设备的信息采集

**1.18.0.0**

*   修复中金所非做市商投资者查询回报的问题
*   修改ydConfig.ini中部分参数的默认值以避免不必要的告警

**1.17.1.0**

*   修复连接可能卡死的问题

**1.17.0.0**

*   优化了部分功能

**1.16.0.0**

*   当SetTradingRight中同时设置ExchangeID, ProductID, InstrumentID时将自动保证正确性
*   设置InputFlowFilename的默认值为inputFlow.txt

**1.15.0.0**

*   优化了部分功能

**1.14.0.0**

*   解决大商所行情连接会产生大量无效错误信息的问题

**1.13.0.0**

*   优化大商所功能

**1.12.0.0**

*   郑商所如果登录失败将会断开连接

**1.11.0.0**

*   离线启动模式中将使用从CTP日初数据中的大商所组合持仓数据，但是正常启动从交易所查询获得
*   郑商所支持从交易所获取日初数据

**1.10.0.0**

*   上期所连接支持服务器检查模式（类似中金所）

**1.7.1.2**

*   修复了大商所盘中重启的一个小问题

**1.7.1.1**

*   增加出入金审核以及代客交易的管理员权限
*   修复了一个小问题

**1.7.1.0**

*   支持为中金所、上期所和大商所设置多个fens
*   ydApi可以选择使用sudo来获取硬盘和网络信息
*   支持记录同一交易日内出入金的记录，重启系统后不再需要重新出入金
*   当遇到持仓错误时，ydServer将尽可能继续运行，但是会自动禁止发生错误持仓的客户的交易权限
*   ydClient中出金时不再需要冻结出金，可以直接出金
*   增加管理员的交易权限，只有设置了交易权限的管理员可以替客户下单
*   扩充了某些系统表的容量至16777215条记录，包括委托、错误委托、外部委托、成交、撤单失败表。

**1.1.6.0**

*   使用最新价来计算持仓盈亏，以符合CTP的计算方法。

**1.1.5.0**

*   YDExchangeInit不再查询客户

**1.1.4.0**

*   修复跨式组合保证金当两腿金额相等时的问题
*   修复客户端计算持仓盈亏的问题
*   当成功设置权限和调整资金时会返回回调
*   管理员用户登录不再检查AppAuthCode

**1.1.3.0**

*   ydApi支持notifyFailedCancelOrder和notifyFailedCancelQuote返回柜台拦截的撤单错误

**1.1.2.0**

*   修复客户端API版本在ydServer登录日志中显示不正确的问题
*   修改上期所和大商所的启动探测机制
*   修复因为引入多种保证金、权利金价格计算方法引入的问题

**1.1.1.0**

*   支持销毁ydApi和ydExtendedApi

**1.1.0.0**

*   **新增ydServer和ydExtendedApi计算保证金的方法，目前支持的方法有：**
    *   计算期货或者期权空头的保证金时使用的基础价格，可以是昨结算、开仓价、最新价、市场成交均价、MAX(最新价，昨结算)
    *   计算期货或者卖出期权的开仓报单的冻结保证金时使用的基础价格，可以是照昨结算、开仓价（市价单使用涨停价）
    *   卖出开仓期权时反向冻结（增加买方权利金）权利金使用的基础价格，可以是昨结算、开仓价（市价单使用涨停价）、不反向冻结
*   修复了某些状态下因为UDP包格式错误导致ydServer卡死的问题
*   修复了ydApi在某些情况下无法正确识别UDPTrading值的问题
*   修复ydExtendedApi中收不到notifyEvent的问题
*   在相同目录下自动备份flow.txt和inputFlow.txt
*   在ydServer、ydApi和相关组件中增加了三段式版本，目前版本为1.1.0，且可以在ydServer中指定Api的最低版本。

**20200424**

*   增加了更多的样例代码
*   增加了YDExtendedListener
*   修改了中金所早登录的机制

**20200416**

*   将上期所和中金所ydExchangeInit的功能合并至ydServer之中

**20200413**

*   支持非管理席位，目前支持全管理席位、首管理其他非管理席位、全非管理席位三种模式。

**20200410**

*   在MarketData中增加AveragePrice，大商所和郑商所来自于交易所，其他交易所由柜台计算。
*   支持自动组合大商所组合持仓。

**20200407**

*   在ydApi中增加getVersion。
*   取消期权持仓盈亏，目前只有期货计算持仓盈亏。

**20200404**

*   支持投资者发起的前置优选。
*   可以限制投资者的最大连接数。
*   投资者可以选择使用默认的席位优选机制、或者自动组合大商所组合持仓。
*   ydApi中增加最大连接数、当前连接数和账户标志字段。

**20200331（大商所组合保证金）**

*   支持大商所组合保证金

**20200321**

*   ydServer只检查AuthCode的前16位。
*   ydClient中删除了指数的权限操作。

**20200306**

*   调整空账户的风险度计算方法，并允许管理员在任意时刻出入金。

**20200221**

*   忽略中金所全面结算会员的会员流水中包含的其他交易会员的委托和成交。
*   改变计算持仓盈亏和买期权冻结资金的价格获取顺序，从对手价、最新价、涨跌停板价、昨结算，改为对手价、最新价、昨收盘、昨结算。
*   如果因为资金不足无法报单的，在inputFlow中打印当时的账号资金情况。

**20200218（重大性能优化）**

*   降低系统运行温度，延长硬件使用寿命。
*   上期所性能较大幅优化，且增加席位数几乎不会影响性能。
*   删除中金所客户报单流控。

**20200213**

*   修复中金所启动卡死的问题
*   性能优化

**20200203**

*   禁止报单产生的委托的撤单
*   性能优化

**20200128**

**支持做市商报价功能**

*   支持上期所、中金所、大商所的做市商报价
*   支持做市商风控

**20200118**

*   普通用户可以发起报价请求
*   做市商用户可以接收报价请求

**20200116**

*   **支持期权行权报单。**
*   支持接收上期所的期权宣告执行和放弃执行。
*   支持接收大商所的期权宣告执行。
*   中金所暂时不支持期权宣告执行和放弃执行。
*   增加非市价单的涨跌停价格检查。
*   修复大商所启动时卡死的问题。

**20200111**

*   修复了无法获取某些特殊网卡属性时客户端奔溃的问题

**20200104**

*   修复了错单中RealConnectionID无法获取的问题
*   ydClient可以重新在WindowsXP上运行
*   中金所报撤单手续费重新按照报单笔数而不是报单量计算，参数名仍然使用OrderCommByVolume和OrderActionCommByVolume以避免大规模修改
*   在YDExtendedApi中增加getOptionsShortMarginPerLot以方便投资者获取每手期权合约的空头保证金
*   修复一些小问题

**20191222**

*   支持CTP冒烟数据中设置在产品或者客户层面的默认费率。
*   统一ydAPI中的ConnectionID的数据类型

**20191217**

*   增加了交易权限默认值设置，可以针对投资者适当性产品设置默认禁止交易。
*   修复了一个小问题。

**20191212**

*   在扩展API中增加OtherCloseProfit的计算，OtherCloseProfit是指所有非期货合约的平仓盈亏

**20191206**

*   在日志中增加投资者登录时使用的API版本信息
*   新增昨权益扣减功能，期货公司可指定某投资者昨权益的扣减部分，例如其他次席系统占用的资金，剩余的昨权益即可通过资金使用率在多套易达系统中按比例分配

**20191126**

*   升级加密方式，升级时需要同时升级授权协议
*   **20191123（支持中金所股指期权）**
*   **支持中金所股指期权**
*   在增加扩展API中增加“每手保证金”字段
*   自成交检查可关闭

**20191111**

*   在增加扩展API中增加“每手保证金”字段

**20191109（重大功能更新）**

*   **增加新版扩展API，提供资金、持仓查询和风控功能**
*   **支持批量委托和撤单功能**
*   增加投资者委托上限的功能，可为每个投资者分配最大的报单数量
*   在API中增加实际报送席位字段，投资者可通过该字段了解报单的实际报送席位
*   增加交易所查询的时间间隔，避免出现查询太快的告警

**20191020**

*   修复因调整服务器时间导致断线的问题
*   修复断线后仍然可以报单的问题

**20190930**

*   ydClient可以通过配置name以区分多个窗口。
*   扩大委托、成交等内存表的记录数，从4096\*256扩至4096\*1024。

**20190925**

*   增加了中金所、上期所临近交割合约不参与大边保证金计算的功能。

**20190919**

*   增强了对穿透式监管报送数据的检查，可以配置参数使得报送数据有问题的客户无法连接成功。
*   可在交易所层面设置是否参与大边，以及平今优先或是平昨优先。

**20190905**

*   修复了大商所启动过程中查询委托和成交时产生大量的告警信息的问题。
*   当席位繁忙时，报撤单请求会重试5ms，改变了之前遇到席位繁忙立即失败的系统行为。
*   减少了初始化过程中的日志量。

**20190822**

*   **API协议版本升级为V1，此版本以及之后的易达交易系统不兼容之前的ydAPI。**
*   增加版本控制功能，当使用低版本连接ydServer时，ydServer会主动断开连接，并在日志中输出低版本登录的告警信息。
*   删除中金所的市价单指令
*   增加中金所跨品种大边保证金功能

**20190815**

*   关闭大商所盘中大边保证金功能。
*   客户端配置文件中可以覆盖UDP和TCP端口，便于投资者理解：
    *   TCPMarketDataServerIP
    *   TCPMarketDataServerPort
    *   UDPTradingServerIP
    *   UDPTradingServerPort
    *   UDPMarketDataClientPort
    *   UDPMarketDataMulticastGroup

**20190810**

*   增加以下管理员操作的审计日志：
    *   SetTradingRight
    *   AlterMoney
    *   ChangePassword (only when change other's password)

**20190807**

*   ydServer可输出报单流水，方便检查不明去向的客户报单

**20190805**

*   增加ydServer的冒烟模式，可以在不连接交易所的情况下启动，方便业务部门提前检查日初数据

**20190803**

*   增加中金所、上期所、大商所的FOK指令
*   修改授权策略，增加绑定席位，只要绑定席位出现在当前环境中，易达系统就能启动，方便建立测试环境和冷备环境

**20190728**

*   修复偶发的遇到交易所查询流控时程序卡死的问题。

**20190724**

*   修复了报单时使用之Fix模式的撤单失败的问题。

**20190714**

*   ydServer支持管理员权限控制，可以设置的权限包括：
    *   SetTradingRight：可以在YDClient中实时设置所有账户的交易权限
    *   AlterMoney：可以在YDClient中实时进行出入金操作（ydSync使用的账号需要此权限）
    *   ManageAccount：在YDClient中可以修改客户口令，在YDAdmin中可以开户、销户、修改账户、修改客户口令
    *   ManageAdminUser：在YDClient中可以修改其他管理员口令，在YDAdmin中可以对对管理员账户增删改，可以修改其他管理员口令
    *   ManageAppAuthCode：在YDAmin中可以管理软件认证码
*   可以设置管理员账户的访问网段，防止投资者误用管理员账号。

**20190710**

*   ydSync支持同时连接多套ydServer环境