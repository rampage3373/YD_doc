简介
==

本文主要讲解易达原生API的使用方法。除了原生API外，易达还提供了裸协议接口和CTP模拟接口，如需了解裸协议的使用方法，请查看[裸协议接口](https://www.hanlinit.com/docs/bare-protocol/)，如需了解CTP模拟接口的使用方法，请查看[CTP应用直连组件](https://www.hanlinit.com/docs/ydctp/)。

易达API提供Linux版本和Windows版本两种，其中Linux版本的ydApi有大量针对Linux平台的优化，使得其性能相对Windows版本较为突出，因此我们推荐投资者使用Linux开发基于ydApi的ydServer应用（简称客户端）。

客户端与ydServer的通信主要包括上行和下行两个部分。上行部分由客户端向ydServer发送请求，比如系统登录、报撤单请求、修改口令和上行心跳信息等。下行部分由ydServer向客户端主动推送交易状态的变化，比如日初静态初始化数据、报单/成交回报、行情等内容；其中日初静态初始化数据将同步到本地的初始数据库；初始化完成后或收到报单/成交回报或行情后会调用客户端的回调函数。客户端程序可使用本地调用YDApi::getX系列函数可获得日初静态初始化数据，但客户需根据报单/成交回报计算自己的保证金、交易费用、可用资金和持仓数据。

ydApi提供C++接口。如上图所示，开发人员仅需通过两个类就可以完成交易功能：一个是YDApi，用于处理上行信息；一个是YDListener，用于处理下行信息，维护本地交易数据，并调用客户端程序提供的回调函数。ydApi程序包主要包括以下文件：

![](https://www.hanlinit.com/wp-content/uploads/2020/06/客户端架构.png)

注意：本说明书中ydApi是指汉霖的API本身，而YDApi是指ydAPI提供的一个基类。

YDClient发布包
===========

ydClient发布包的目录结构如下所示：

*   ydAPI
    *   include：ydApi的头文件
    *   linux64：Linux操作系统的ydApi的动态链接库
    *   win32：Windows操作系统的ydApi的动态链接库
    *   example：使用ydApi开发客户端程序的示例
*   ydClientWin：交易和管理客户端程序，在开发测试阶段可用于核对交易和钱仓结果，生产阶段可用于监控程序运行情况。
*   ydCTP
    *   include：CTP的头文件
    *   linux64：Linux操作系统的CTP应用直连组件的动态链接库
    *   win32：Windows操作系统的CTP应用直连组件的动态链接库
    *   example：用于CTP应用直连组件的配置文件范例

操作系统依赖
------

根据监管要求，ydApi需要获取宿主机的BIOS等信息，因此可能需要Administrator权限（Windows版本）或者root权限（Linux版本）。除此以外，Windows版本基本没有操作系统方面的依赖。

Linux方面需要：

*   Kernel版本：不低于2.6.18。
*   GNU libc版本：不低于2.5。可以使用ldd -–version命令查看。
*   设置dmidecode使普通用户能够获取BIOS等硬件信息。为了便于适配投资者的安全策略，可以在config文件中设置ReportMethod决定dmidecode的调用方式。Linux下0表示使用suid方式，1表示使用sudo方式。

初始化流程
=====

常规流程
----

ydServer仅提供推送模式的数据初始化模式，不提供查询功能。基于推送的数据初始化主要包括以下步骤：

1.  启动客户端应用程序，调用makeYDApi或者makeExtendedApi创建Api对象，创建时需要准备好客户端配置文件，并作为创建Api的参数。
2.  客户端应用程序调用start启动ydApi，启动时需要注入YDListener用于接收回调。
3.  ydApi会主动连接易达柜台，如果连接成功，则会回调YDListener::notifyReadyForLogin。
4.  客户端在YDListener::notifyReadyForLogin中调用login，此时需要客户号、密码、AppID和AppAuthCode。
5.  成功登录后，ydApi会回调YDListener::notifyLogin，返回信息中包含此刻客户在服务器上属于该客户的最大的流水号，此流水号已经覆盖了日初静态数据、本交易日前次登录（如果有的话）的报单和成交回报。
6.  成功登录后，ydServer立即向客户端推送本交易日的日初静态数据（包括日初资金、持仓、保证金率、费率等静态数据），结束后ydApi回调YDListener::notifyFinishInit，告知客户日初数据接收结束。请注意，此时还未接收本交易日发生的报单和成交信息，因此此时调用查询持仓、资金的操作会失败。
7.  ydServer向客户端通过YDListener::notifyOrder和YDListener::notifyTrade推送本交易日已经发生的报单和成交信息，一旦流水号等于登录时的最大流水号，ydApi触发回调函数YDListner::notifyCaughtUp，表示委托和成交已经追平。
8.  至此，数据已完成初始化，客户可以开始自身业务处理了。一旦有新的报单和成交回报，ydApi会调用YDListener::notifyOrder和YDListener::notifyTrade。

客户端断线重连
-------

1.  如果ydApi侦测到断线后会重连ydServer，连接成功后，ydApi会将断线前收到的最大下行流水号送入ydServer，并回调YDListener::notifyReadyForLogin。
2.  客户端在YDListener::notifyReadyForLogin中调用login，此时需要客户号、密码、AppID和AppAuthCode。
3.  登录成功后，ydServer向客户端通过YDListener::notifyOrder和YDListener::notifyTrade推送断线前最大下行流水号之后的报单和成交信息，一旦流水号等于登录时的最大流水号，ydApi触发回调函数YDListner::notifyCaughtUp，表示委托和成交已经追平。
4.  此时，系统即可恢复正常交易。

客户端配置文件
=======

在调用makeYDApi方法时需要指定客户端使用的配置文件。配置文件中的参数主要包括三类：

*   网络配置，包括ydServer的IP地址和端口，其中端口请始终填写期货公司提供的TCP端口，其他端口包括UDP报单端口、TCP行情端口会在登录后自动下发，是否启用UDP报单是有UDPTrading参数控制的。
*   交易配置，包括是否使用UDP报单，以及接收回报线程的工作方式。
*   行情配置，包括是否接收ydServer的TCP或者UDP行情。

以下为ydApi提供的用于生产环境的客户端配置文件最佳实践模板，该模板最终实现的效果是：

*   使用UDP报单
*   忙查询接收TCP回报，加快回报的获取速度，并把接收线程绑定在3号CPU
*   此配置不接收ydServer的TCP和UDP转发行情，因此也不会启动接收线程

    ###########################################
    ######### Network configurations  #########
    ###########################################
    
    # Count of recovery site. Used to achieve high availablity at the expense of a little performance of order notification.
    # 0 for no recovery, 1 for recovery always use primary site, 2 for recovery use primary and secondary sites
    RecoverySiteCount=0
    
    # IP address of primary trading server
    TradingServerIP=127.0.0.1
    
    # TCP port of primary trading server, other ports will be delivered after logged in
    TradingServerPort=51000
    
    # IP address of secondary trading server.
    # Valid only when RecoverySiteCount equals to 2.
    TradingServerIP2=127.0.0.2
    
    # TCP port of secondary trading server, other ports will be delivered after logged in.
    # Valid only when RecoverySiteCount equals to 2.
    TradingServerPort2=51000
    
    ###########################################
    ######### Trading configurations  #########
    ###########################################
    
    # Work mode for recalculation of margin and position profit. Valid when using ydExtendedApi.
    #     auto(default): subscribe market data and automatically recalculate in proper time.
    #     subscribeOnly: subscribe market data and recalcMarginAndPositionProfit should be called explicitly
    #     off: never do recalculation
    RecalcMode=auto
    
    # Gap between recalculations, in milliseconds. Valid when RecalcMode is set to auto.
    # It will be adjusted to 1000 if less than 1000
    RecalcMarginPositionProfitGap=1000
    
    # Delay of recalculation after market data arrives to avoid collision with input order, in milliseconds.
    # Valid when RecalcMode is set to auto. Should be between 0 and 100.
    RecalcFreeGap=100
    
    # Whether using UDP when sending orders, no for sending TCP orders
    # When accessing yd trading server via Internet or other UDP-banned network enviornments, must set to no
    UDPTrading=yes
    
    # Timeout of select() when receiving order/trade notifications, in millisec. -1 indicates running without select()
    TradingServerTimeout=-1
    
    # Affinity CPU ID for thread to receive order/trade notifications, -1 indicate no need to set CPU affinity
    TCPTradingCPUID=3
    
    ###########################################
    ####### MarketData configurations  ########
    ###########################################
    
    # Whether need to connect to TCP market data server
    ConnectTCPMarketData=no
    
    # Timeout of select() when receiving TCP market data, in millisec. -1 indicates running without select()
    TCPMarketDataTimeout=-1
    
    # Affinity CPU ID for thread to receive TCP market data, -1 indicate no need to set CPU affinity
    TCPMarketDataCPUID=-1
    
    # Whether need to receive UDP multicast market data
    ReceiveUDPMarketData=no
    
    ###########################################
    ######### Other configurations  ###########
    ###########################################
    
    AppID=yd_dev_1.0
    AuthCode=ecbf8f06469eba63956b79705d95a603
    

网络配置
----

网络配置包含易达柜台的IP地址和端口，生产环境交易时，请向所在期货公司技术部门询问具体配置情况。

**RecoverySiteCount：**高可用节点个数。当为0时，不启用API高可用特性；当为1时，启用单柜台高可用特性，当柜台重启后，API会重新连接柜台并尽可能恢复到最新状态，从而不会导致API直接退出；当为2时，启用主备双柜台高可用特性，当主柜台因故障停止备用柜台（在TradingServerIP2和TradingServerPort2中指定）启动后，API会重新连接柜台并恢复到最新状态。使用高可用特性，会损失极为微小的回报性能为代价。

**TradingServerIP：**易达柜台的IP地址

**TradingServerPort：**易达柜台的端口。易达柜台通常会开放三个端口，分别是TCP交易、TCP行情和UDP交易，UDP行情端口默认关闭。TradingServerPort需要填入的是TCP交易的端口，其他端口会在登录成功后由柜台自动下发到客户端。请不要将UDP交易端口填入TradingServerPort，否则会导致无法连接易达柜台，如果你希望通过UDP报单，请通过UDPTrading=yes参数控制。

**TCPMarketDataServerPort：**TCP行情的端口，通常情况这个端口由柜台自动下发，不需要也尽量不要填写。当需要从外网访问内网柜台而做了NAT时，对外的行情端口可能会发生改变，此时下发的端口将无法正确接收行情，需要根据期货公司提供的实际端口配置该参数。

**UDPTradingServerPort：**UDP交易的端口，通常情况这个端口由柜台自动下发，不需要也尽量不要填写。当需要从外网访问内网柜台而做了NAT时，对外的UDP交易端口可能会发生改变，此时下发的端口将无法正确接收UDP报单数据，需要根据期货公司提供的实际端口配置该参数。

**TradingServerIP2：**易达备用柜台的IP地址。RecoverySiteCount为2时生效。

**TradingServerPort2：**易达备用柜台的端口。设置方法同TradingServerPort。RecoverySiteCount为2时生效。

**TCPMarketDataServerPort2：**易达备用柜台的TCP行情端口，使用方法同TCPMarketDataServerPort。RecoverySiteCount为2时生效。

**UDPTradingServerPort2：**易达备用柜台的UDP交易端口，使用方法同UDPTradingServerPort。RecoverySiteCount为2时生效。

交易配置
----

**RecalcMode：**保证金和持仓盈亏的重算模式，只对ydExtendedApi有效。默认值为auto。

*   auto：完全由API负责重算保证金和持仓盈亏，API会自动订阅计算需要的行情。可以通过RecalcMarginPositionProfitGap和RecalcFreeGap这两个参数控制刷新间隔和距离行情的延时时间。
*   subscribeOnly：只帮助自动订阅需要的行情，但是需要由投资者自行调用recalcMarginAndPositionProfit重算方法。
*   off：不重算保证金和持仓盈亏。通常投资者不应该使用这个模式。

**RecalcMarginPositionProfitGap：**两次重算之间的间隔，单位为毫秒，默认为1000毫秒。最小值为1000，如果小于1000，系统自动会调整为1000。本参数只有当RecalcMode为auto时才有效。

**RecalcFreeGap：**距离行情的延时间隔。为了尽可能避免与报单发生冲突，要尽可能避免在行情到来的时候重算，投资者可以根据不同交易所调整参数使得行情在两个时间切片报单较为空闲的时间重算。单位为毫秒，默认值为100毫秒，必须介于0和100之间，否则大于100的值会被调整为100，小于0的值会被调整为0。本参数只有当RecalcMode为auto时才有效。

**UDPTrading：**指示使用UDP或者TCP发送报单，yes表示使用UDP报单，no表示使用TCP报单。在生产环境，我们强烈建议一定使用UDP进行报单，因为易达柜台的极速性能是由UDP交易提供的，TCP性能较UDP较差，无法发挥易达柜台应有的性能。但是在某些不支持UDP报单的环境，如互联网、经过防火墙隔离的网络环境，除非经过特殊的网络设置，通常情况下在这类网络环境UDP是不可达的，此时请一定配置为UDPTrading=no，否则会导致登录成功但是报单无效的情况。

**TradingServerTimeout：**设置该参数指示YDListener的TCP交易接收线程如何使用监听网络通信。如果设置为正整数值，表示该线程使用POSIX的select机制去监听是否有网络数据到达，监听时间间隔为所指定的值，单位为毫秒。设置为-1，接收线程将以非阻塞方式读取信息，其CPU使用率会达到100%，如果客户端未根据自身机器的配置情况合理分配CPU/Core，设置线程与CPU/Core的亲和性，将严重影响客户端程序的运行性能，延迟会显著增加。

**TCPTradingCPUID：**设置TCP交易回报接收线程的亲和性。-1代表不需要设置亲和性；否则为CPU/Core的编号。

行情配置
----

请注意，无论是TCP行情还是UDP组播行情，易达的行情均不是高速行情，目前仅可用于易达服务端和客户端用于计算保证金和盈亏。如在生产交易中需要行情，请联系期货公司接收组播行情。

**ConnectTCPMarketData：**是否连接ydServer的TCP行情服务。yes表示接收，no表示不接收。

**TCPMarketDataTimeout：**设置该参数指示YDListener的TCP行情接收线程如何使用监听网络通信。如果设置为正整数值，表示该线程使用POSIX的select机制去监听是否有网络数据到达，监听时间间隔为所指定的值，单位为毫秒。设置为-1，接收线程将以非阻塞方式读取信息，其CPU使用率会达到100%，如果客户端未根据自身机器的配置情况合理分配CPU/Core，设置线程与CPU/Core的亲和性，将严重影响客户端程序的运行性能，延迟会显著增加。

**TCPMarketDataCPUID：**设置TCP行情接收线程的亲和性。-1代表不需要设置亲和性；否则为CPU/Core的编号。

**ReceiveUDPMarketData：**是否接收ydServer发送的UDP组播行情。目前所有易达柜台的UDP组播行情功能均是关闭的，请始终保持该参数为no。

其他配置项
-----

**ReportMethod：**在生成客户端报告时调用dmidecode的方法，Windows下无意义。Linux下0表示使用suid方式，即需要通过chmod +s /usr/sbin/dmidecode增加权限；1表示使用sudo方式，ydApi会通过sudo dmidecode调用获取硬件信息。

**AppID和AuthCode：**投资者可以在配置文件中设置AppID和AuthCode，并在登陆调用login时appID和authCode分别填入NULL，API就会使用配置文件中配置的值。

**LogDir：**指定ydApi产生日志的目录，默认为log。目录不会自动产生，需要手工创建，如果没有对应的目录存在，则不会产生日志文件。

高可用性
====

从1.108版本开始，易达提供了两种高可用模式：单柜台高可用和主备柜台高可用。

当API打开高可用特性时，API在柜台故障时会探测可用节点并进行连接，只要新连接的柜台具有相同的签名，API即可基本无感知地重新连接到新启动的柜台，无论是重新启动的柜台还是备用服务器上的柜台。柜台签名主要用于判断一个柜台实例是否与API之前连接的相兼容，包括连接的交易所、席位、日初数据等，以避免因为配置错误等原因导致误用错误的柜台。需要注意的是，使用高可用会给API带来微小的回报性能开销，请在使用高可用前测试性能以确定是否能接受性能开销。

可以通过配置[RecoverySiteCount](#RecoverySiteCount)等高可用参数打开API高可用功能，详情请[参阅具体内容](#RecoverySiteCount)。

单柜台高可用无需柜台端配置，API开启后即可实现柜台重启后API不退出的效果。API开启了单柜台高可用（RecoverySiteCount=1）并启动后，将会如常连接柜台，当柜台重启后，API会首先会从notifyEvent收到YD\_AE\_ServerRestarted=4的消息，然后API会自动重连重启后的柜台。

主备柜台高可用可以确保最大程度上的高可用，当宕机、断网等故障发生时，投资者的交易会在最短时间内恢复。主备柜台高可用需要三台服务器组成一个集群，其主用服务器正常时处于启动状态；备用服务器通常处于停止状态，只有当发生切换时才会启动；仲裁机用来判断柜台节点的可用性并作出切换决策，没有性能要求。为了避免网络故障带来的无效切换，我们通常会建议期货公司配置两路网络。配置主备高可用模式，服务端需要付费授权文件的支持才能使用，API没有限制。API开启了主备柜台高可用（RecoverySiteCount=2）并启动后，将会优先连接主用柜台，当主用柜台无法提供服务后（如宕机、断网），API会首先会从notifyEvent收到YD\_AE\_ServerRestarted=4的消息，然后API会自动重连备用柜台。双机高可用的系统连接图如下所示。

![](https://www.hanlinit.com/wp-content/uploads/2021/08/high_availablity_topology.png)

无论采用何种高可用方式，之前的交易数据都得以保留，但是如果存在中断期间交易所的回报，系统将不能正确识别和匹配客户的报单，因此，可能会收到OrderRef和OrderLocalID为-1的委托回报或者成交回报，投资者需要根据实际情况予以处理，处理的方式有以下两种：

*   直接删除收到YD\_AE\_ServerRestarted后的已经存在的挂单，然后把OrderRef和OrderLocalID为-1的委托回报或者成交回报当做外部系统的委托和成交处理。
*   按照合约、价格、数量等属性进行报单匹配，如果发现还有匹配不上的，说明这些委托并没有发送到交易所，直接在本地删除这些挂单即可。

高可用保证自动切换时数据的完整性，如果服务端发生重启后，投资者主动重启API，服务端重启前的委托的OrderRef和OrderLocalID将被设置为-1。

数据类型
====

数据类型位于头文件ydDataType.h。

ProductClass
------------

产品类型。

**定义**

**说明**

YD\_PC\_Futures=1

期货产品。

YD\_PC\_Options=2

期权产品。

YD\_PC\_Combination=3

组合产品。

YD\_PC\_Index

指数

YD\_PC\_Cash

现货

OptionsType
-----------

期权类型。

**定义**

**说明**

YD\_OT\_NotOption=0

非期权。

YD\_OT\_CallOption=1

看涨期权。

YD\_OT\_PutOption=2

看跌期权。

Direction
---------

报单买卖方向。

**定义**

**说明**

YD\_D\_Buy=0

买入。

YD\_D\_Sell=1

卖出。

YD\_D\_Make=0

组合持仓。当YDOrderFlag为YD\_YOF\_CombPosition有效。

YD\_D\_Split=1

拆分组合持仓。当YDOrderFlag为YD\_YOF\_CombPosition有效。

PositionDirection
-----------------

持仓方向。

**定义**

**说明**

YD\_PD\_Long=2

多头持仓。

YD\_PD\_Short=3

空头持仓。

PositionDate
------------

持仓日期。

**定义**

**说明**

YD\_PSD\_Today=1

今日新开仓位，仅适用于SHFE和INE。

YD\_PSD\_History=2

**历史仓位。**

HedgeFlag
---------

套保标志。

**定义**

**说明**

YD\_HF\_Speculation=1

投机。

YD\_HF\_Arbitrage=2

套利，仅适用于CFFEX。

YD\_HF\_Hedge=3

保值。

YD\_HF\_Internal=4

协议内部使用。

YD\_MaxHedgeFlag=4

仅协议内部使用。

在本系统中，HedgeFlag的使用规则如下：

*   对于CFFEX，支持YD\_HF\_Speculation，YD\_HF\_Arbitrage和YD\_HF\_Hedge
*   对于SHFE、INE和DCE，支持YD\_HF\_Speculation和YD\_HF\_Hedge

TradeRight
----------

交易权限。

**定义**

**说明**

YD\_TR\_Allow=0

客户交易权限，允许交易，包括开仓、平仓和撤单。

YD\_TR\_CloseOnly=1

仅允许平仓和撤单。

YD\_TR\_Forbidden=2

不允许交易，允许撤单。

OffsetFlag
----------

开平仓标志。

**定义**

**说明**

YD\_OF\_Open=0

开仓。

YD\_OF\_Close=1

平仓，不适用于SHFE和INE。

YD\_OF\_ForceClose=2

强制平仓。

YD\_OF\_CloseToday=3

平今日新开仓，仅适用于SHFE和INE。

YD\_OF\_CloseYesterday=4

平历史仓，仅适用于SHFE和INE。

根据我们的理解：SHFE和INE区分了平今日新开仓位和平历史仓位；CFFEX在平仓时优先使用今日新开仓位；DCE和CZCE在平仓时优先使用历史仓位。客户可以查询YDExchange::UseTodayPosition字段来判断平仓时交易所选用何种仓位。

客户需要根据初始化持仓和当日成交情况自行计算历史仓位和今日新开仓位，并根据交易所规则选用不同的开平仓标志。

在本系统中，开平标志的使用规则如下：

*   对于SHFE和INE，可以使用YD\_OF\_CloseToday或者YD\_OF\_CloseYesterday。如果客户下了非YD\_OF\_CloseToday的平仓单，一律被自动改为YD\_OF\_CloseYesterday。
*   对于CFFEX和DCE，可以使用YD\_OF\_Close。如果客户下了非开仓单，一律被自动改为YD\_OF\_Close。

OrderType
---------

指令类型。

**定义**

**说明**

YD\_ODT\_Limit=0

限价报单。

YD\_ODT\_FAK=1

FAK类报单。

YD\_ODT\_Market=2

市价报单。

YD\_ODT\_FOK=3

FOK类报单。

易达系统中定义的指令类型是交易所指令类型条件的组合，针对每个交易所选择最贴近易达指令类型的组合进行设置，以下为各个交易所中的对照关系：

**交易所**

**YD\_ODT\_Limit**

**YD\_ODT\_FAK**

**YD\_ODT\_Market**

**YD\_ODT\_FOK**

CFFEX

FFEX\_FTDC\_TC\_GFD  
FFEX\_FTDC\_OPT\_LimitPrice  
FFEX\_FTDC\_VC\_AV

FFEX\_FTDC\_TC\_IOC  
FFEX\_FTDC\_OPT\_LimitPrice  
FFEX\_FTDC\_VC\_AV

FFEX\_FTDC\_TC\_IOC  
FFEX\_FTDC\_OPT\_AnyPrice  
FFEX\_FTDC\_VC\_AV

FFEX\_FTDC\_TC\_IOC  
FFEX\_FTDC\_OPT\_LimitPrice  
FFEX\_FTDC\_VC\_CV

SHFE

SHFE\_FTDC\_TC\_GFD  
SHFE\_FTDC\_OPT\_LimitPrice  
SHFE\_FTDC\_VC\_AV

SHFE\_FTDC\_TC\_IOC  
SHFE\_FTDC\_OPT\_LimitPrice  
SHFE\_FTDC\_VC\_AV

SHFE\_FTDC\_TC\_IOC  
SHFE\_FTDC\_OPT\_AnyPrice  
SHFE\_FTDC\_VC\_AV

SHFE\_FTDC\_TC\_IOC  
SHFE\_FTDC\_OPT\_LimitPrice  
SHFE\_FTDC\_VC\_CV

DCE

OT\_LO  
OA\_NONE

OT\_LO  
OA\_FAK

OT\_MO  
OA\_FAK

OT\_LO  
OA\_FOK

CZCE

FID\_OrderType=0 //限价  
FID\_MatchCondition=3 //当日有效

FID\_OrderType=0 //限价  
FID\_MatchCondition=2 //即时部分成交

FID\_OrderType=1 //市价  
FID\_MatchCondition=2 //即时部分成交

FID\_OrderType=0 //限价  
FID\_MatchCondition=1 //即时全部成交

SSE

Limit  
GFD

Limit  
FOK

Market  
IOC

Limit  
FOK

OrderStatus
-----------

报单状态。

**定义**

**说明**

YD\_OS\_Accepted=0

报单已被ydServer校验通过并送往交易所，尚未收到交易所回报。该状态不会回给ydApi和客户端。

YD\_OS\_Queuing=1

报单已被交易所确认且有效。可能部分成交，也可能未成交。

YD\_OS\_Canceled=2

报单已被撤销。可能是客户主动撤销，也可能是FAK类或市价类报单被交易所系统自动撤销。

YD\_OS\_AllTraded=3

完全成交。

YD\_OS\_Rejected=4

报单被ydServer或者交易所拒绝，拒绝原因存放在YDInputOrder的ErrorNo字段中。如果该字段小于1000，则是被ydServer拒绝，拒绝原因查看ydError.h头文件；如果大于1000，则为交易所拒绝，该字段减去1000即为交易所返回的错误号。

YDOrderFlag
-----------

报单标志。

**定义**

**说明**

YD\_YOF\_Normal=0

普通报单。

YD\_YOF\_QuoteDerived=1

因做市商报价产生的报单，此类报单不可直接操作。

YD\_YOF\_OptionExecute=2

期权执行申请。

YD\_YOF\_OptionAbandonExecute=3

放弃期权自动执行。

YD\_YOF\_RequestForQuote=4

向做市商发送的报价请求。

YD\_YOF\_CombPosition=5

组合持仓。

YD\_YOF\_OptionExecuteTogether=6

合并行权。

YDQuoteFlag
-----------

报价标志。

**定义**

**说明**

YD\_YQF\_ResponseOfRFQ=1

报价响应。

YDCombHedgeFlag
---------------

组合套保标志。

**定义**

**说明**

YD\_CHF\_SpecSpec=1

投投

YD\_CHF\_SpecHedge=2

投套

YD\_CHF\_HedgeHedge=3

套套

YD\_CHF\_HedgeSpec=4

套投

YD\_MaxCombHedgeFlag=4

DCECombPositionType
-------------------

大商所组合持仓类型。

**定义**

**说明**

YD\_CPT\_DCE\_FuturesOffset=0

期货对锁

YD\_CPT\_DCE\_OptionsOffset=1

期权对锁

YD\_CPT\_DCE\_FuturesCalendarSpread=2

期货跨期

YD\_CPT\_DCE\_FuturesProductSpread=3

期货跨品

YD\_CPT\_DCE\_BuyOptionsVerticalSpread=4

买入期权垂直价差

YD\_CPT\_DCE\_SellOptionsVerticalSpread=5

卖出期权垂直价差

YD\_CPT\_DCE\_OptionsStraddle=7

期权跨式

YD\_CPT\_DCE\_OptionsStrangle=8

期权宽跨

YD\_CPT\_DCE\_BuyOptionsCovered=9

买权覆盖

YD\_CPT\_DCE\_SellOptionsCovered=10

卖权覆盖

SSE/SZSECombPositionType
------------------------

上交所/深交所组合持仓类型。

**定义**

**说明**

YD\_CPT\_StockOption\_CNSJC=100

认购牛市价差

YD\_CPT\_StockOption\_CXSJC=101

认购熊市价差

YD\_CPT\_StockOption\_PNSJC=102

认沽牛市价差

YD\_CPT\_StockOption\_PXSJC=103

认沽熊市价差

YD\_CPT\_StockOption\_KS=104

跨式空头

YD\_CPT\_StockOption\_KKS=105

宽跨式空头

ConnectionSelection
-------------------

席位选择。

**定义**

**说明**

YD\_CS\_Any=0

不指定交易所席位连接。ydServer将根据现有席位连接情况尽快将报单请求或撤单请求送入交易所。

YD\_CS\_Fixed=1

指定交易所席位连接。如果该席位连接因流控或断链等原因不可用，ydServer将等待该席位可用后将请求送入交易所。

YD\_CS\_Prefered=2

指定交易所席位连接。如果该席位连接因流控或断链等原因不可用，ydServer将根据现有其他席位连接情况尽快将报单请求或撤单请求送入交易所。

AlterMoneyType
--------------

仅由管理员使用。

**定义**

**说明**

YD\_AM\_ModifyUsage=0

调整资金使用率

YD\_AM\_Deposit=1

入金

YD\_AM\_FrozenWithdraw=2

出金前冻结客户资金

YD\_AM\_CancelFrozenWithdraw=3

取消出金前冻结客户资金

YD\_AM\_WithdrawYD\_CS\_Prefered=4

出金

YD\_AM\_DepositTo=5

通过指定目标余额入金

YD\_AM\_WithdrawTo=6

通过指定目标余额出金

YD\_AM\_ForceModifyUsage=7

强制调整资金使用率

Request Type
------------

仅由管理员使用。

**定义**

**说明**

YD\_RT\_ChangePassword=0

修改密码

YD\_RT\_SetTradingRight=1

修改交易权限

YD\_RT\_AlterMoney=2

出入金和设置资金参数

YD\_RT\_SeletionConnection=3

席位优选

YD\_RT\_AdminTrading=4

管理员是否有交易权限

YD\_RT\_UpdateMarginRate=5

修改保证金率（目前仅对ETF期权有效）

API Event
---------

**定义**

**说明**

YD\_AE\_TCPTradeConnected=0

TCP交易连接成功后推送的事件。

YD\_AE\_TCPTradeDisconnected=1

TCP交易断开连接后推送的事件。

YD\_AE\_TCPMarketDataConnected=2

TCP行情连接成功后推送的事件。

YD\_AE\_TCPMarketDataDisconnected=3

TCP行情断开连接后推送的事件。

YD\_AE\_ServerRestarted=4

发现服务器重启，客户端退出前推送的事件。

YD\_AE\_ServerSwitched=5

客户端切换到备份节点后推送的事件。

Account Flag
------------

账户功能标志

**定义**

**说明**

YD\_AF\_SelectConnection=1

可以向柜台发布席位优选结果

YD\_AF\_AutoMakeCombPosition=2

允许柜台帮助自动组合持仓

YD\_AF\_BareProtocol=4

允许投资者使用裸协议报单

YD\_AF\_DisableSelfTradeCheck=8

禁止投资者自成交检查

Base Price Type
---------------

保证金计算价格类型。

**定义**

**说明**

YD\_CBT\_PreSettlementPrice=0

昨结算价

YD\_CBT\_OpenPrice=1

开仓价

YD\_CBT\_LastPrice=2

最新价

YD\_CBT\_MarketAveragePrice=3

市场均价

YD\_CBT\_MaxLastPreSettlementPrice=4

昨结算和最新价的大值

YD\_CBT\_OrderPrice=5

报单价格

YD\_CBT\_None=6

不纳入计算

YD\_CBT\_SamePrice=7

冻结保证金时，使用持仓保证金的价格类型

IDType in IDFromExchange
------------------------

从交易所返回的ID类型。

**定义**

**说明**

YD\_IDT\_NormalOrderSysID=0

普通的SysID

YD\_IDT\_QuoteDerivedOrderSysID=1

报价衍生的SysID

YD\_IDT\_OptionExecuteOrderSysID=2

期权执行SysID

YD\_IDT\_OptionAbandonExecuteOrderSysID=3

期权放弃执行SysID

YD\_IDT\_RequestForQuoteOrderSysID=4

报价SysID

YD\_IDT\_CombPositionOrderSysID=5

构建组合SysID

YD\_IDT\_TradeID=128

成交ID

YD\_IDT\_CombPositionDetailID=129

组合持仓明细ID

General Risk Param Types
------------------------

通用风控参数类型。

**定义**

**说明**

YD\_GRPT\_OptionLongPositionCost=1

权利仓持仓限额

YD\_GRPT\_TradePositionRatio=2

成交持仓比

YD\_GRPT\_OrderCancelRatio=3

报撤单比

数据结构体
=====

数据结构体中以SystemUse开头的字段为ydApi内部使用字段，客户端不应对其作任何假设，更不应对其作修改。

用户自定义字段在YDListener::notifyFinishInit()回调前全部复位为0，客户端程序可以将部分业务逻辑的数值存放在此，ydApi不会对其修改。C++中被mutable修饰的变量，即使在const函数也处于可变的状态。简单的数据可以存放在UserFloat、UserInt1和UserInt2中，如果客户自定义数据复杂，则可以使用类或结构体，将其对象的地址存放在pUser字段中。

YDSystemParam
-------------

系统参数，YDString是一个字符数组。

**声明**

**说明**

YDString Name

参数名称

YDString Target

参数的适用对象

YDString Value

参数值

目前支持的参数清单为：

**Name**

**Target**

**Values**

MarginLowerBoundaryCoef

MarginCalcMethod1

股指期权保证金算法中的保障系数，浮点数，缺省值0.5

MarginBasePrice

Futures或者Options

计算期货或者期权空头的保证金时使用的基础价格，可以选择的值如下：（缺省是0）  
0：昨结算价  
1：开仓价  
2：最新价  
3：市场平均成交价  
4：最新价和昨结算价之间的较大值  
CTP目前的常用规则是期货为1，期权为4

OrderMarginBasePrice

Futures或者Options

计算期货或者卖出期权的开仓报单的冻结保证金时使用的基础价格，可以选择的值如下：（缺省是0）  
0：昨结算价  
5：报单价（对于市价单，使用涨停板）  
7: 使用MarginBasePrice的价格  
CTP目前使用的规则对应期货和期权都为1  
注意，期权执行申请报单中冻结的保证金永远是基于昨结算价的

SellOrderPremiumBasePrice

Options

计算卖出开仓期权时反向冻结权利金使用的基础价格，可以选择的值如下：（缺省是0）  
0：昨结算价  
5：报单价（对于市价单，使用跌停板）  
6：不反向冻结  
CTP目前使用的规则对应于6  
注意，买入开仓期权时冻结的权利金永远是报单价（对于市价单，使用涨停板）

YDExchangeTradeConstrain
------------------------

交易所流量限制。

**声明**

**说明**

int ExchangeOrderSpeed

指定时间间隔的报单数量

int ExchangeOrderPeriod

时间间隔，以秒为单位

YDExchange
----------

交易所信息。

**声明**

**说明**

YDExchangeID ExchangeID

交易所编码，字符串。比如CFFEX，SHFE，DCE，CZCE等。

int ExchangeRef

交易所序号

int ConnectionCount

ydServer席位连接数。

int ProductRefStart

产品起止序号

int ProductRefEnd

产品终止序号

bool UseTodayPosition

是否需要标识今日新开仓，SHFE/INE使用此项。

bool UseArbitragePosition

是否需要标识套利仓位。CFFEX使用此项。

bool CloseTodayFirst

平仓是否平今日新开仓位优先。CFFEX使用此项。

bool SingleSideMargin

单向大边收取保证金，SHFE/INE、CFFEX和DCE使用此项。

int OptionExecutionSupport

是否支持期权执行。0为不支持，1为不含风控功能的支持，2为含风控功能的支持。

int OptionAbandonExecutionSupport

是否支持放弃期权自动执行。0为不支持，1为不含风控功能的支持，2为含风控功能的支持。

int QuoteVolumeRestriction

双边报价量限制。0为只允许单边报价，1为允许不同数量的双边报价，2为要求相同数量的双边报价。

short FutureMarginType

期货保证金类型。0为买方和卖方单独计算；1为MAX（买方保证金，卖方保证金），郑商所使用。

bool CombineHedgeSpecPosition

套保投机仓位合并处理标志，适用郑商所。当这个标志为TRUE，套保仓可以当投机仓处理。

bool TradeStockOptions

是否支持证券ETF期权交易

YDExchangeTradeConstrain  
TradeConstrains\[YD\_MaxHedgeFlag\]

投机、套利、保值、做市商在交易所级别的交易限制。

mutable void \*pUser  
mutable double UserFloat  
mutable int UserInt1  
mutable int UserInt2

用户自定义字段

YDTradeConstraint
-----------------

交易限制。

**声明**

**说明**

int OpenLimit

总开仓量上限，-1表示无限制。手数。

int CancelLimit

总撤单量上限，-1表示无限制。笔数。

int PositionLimit

总持仓量上限，-1表示无限制。手数。

int TradeVolumeLimit

总成交量上限，-1表示无限制。手数。

int DirectionOpenLimit\[2\]

多空方向开仓量上限，-1表示无限制。手数。

int DirectionPositionLimit\[2\]

多空方向总持仓量上限，-1表示无限制。手数。

所谓交易所级别限制是指该交易账户在交易所所有合约的加总后的限制量。比如如果设置了OpenLimit为500，则表明该交易账户当日在交易所所有合约的报单和成交总的开仓手数不能超过500手。

以下为各参数的解释：

*   HedgeFlag：投保标志，1表示投机，2表示套利，3表示套保，如果设置为0或者-1，表示此限制对于投机、套保和套利（如果有的话）均适用。
*   ProductOpenLimit，开量：允许各交易账户在该产品总开仓量（手）限制。
*   ProductCancelLimit，撤单笔数：允许各交易账户在该产品撤单量限制，即撤单笔数。
*   ProductPositionLimit，限仓：允许各交易账户在该产品总持仓量（手）限制。
*   ProductTradeVolumeLimit，限制成交手数：允许各交易账户在该产品总成交量（手）限制。
*   ProductBuyOpenLimit，多头开仓手：允许各交易账户在该产品买入开仓量限制。
*   ProductSellOpenLimit，空头开仓手。
*   ProductLongPositionLimit，多头限仓。
*   ProductShortPositionLimit，空头限仓。

系统使用了“悲观”算法进行流量等控制，比如对于撤单笔数，如果客户申报了限价单，则其撤单笔数立即增加；如果该报单全部成交或者被交易所拒绝，则其撤单笔数会返还。该规则同样使用于开量、限仓和限制成交手数。

YDProduct
---------

产品信息。

**声明**

**说明**

YDProductID ProductID

产品代码。

int ProductRef

产品序号

int ExchangeRef

交易所序号

int ProductClass

产品类型：YD\_PC\_Futures,YD\_PC\_Options，YD\_PC\_Combination。

int Multiple

合约单位

double Tick

最小变动价位

double UnderlyingMultiply

期权基础产品的乘数，仅用于期权

int MaxMarketOrderVolume

市价报单的最大报单量。

int MinMarketOrderVolume

市价报单的最小报单量。

int MaxLimitOrderVolume

限价报单的最大报单量。

int MinLimitOrderVolume

限价报单的最小报单量。

int InstrumentRefStart

合约起止序号

int InstrumentRefEnd

合约终止序号

int SystemUse7\[32\]

系统字段

const YDProduct \*m\_pMarginProduct

计算产品保证金的产品

const YDExchange \*m\_pExchange

所属YDExchange的指针。

mutable void \*pUser  
mutable double UserFloat  
mutable int UserInt1  
mutable int UserInt2

当使用YDExtendedAPI时，这些字段不可用。

YDInstrument
------------

合约。

**声明**

**说明**

YDInstrumentID InstrumentID

合约代码。

int InstrumentRef

合约编号

int ProductRef

产品序号

int ExchangeRef

交易所序号

int ProductClass;

产品类型：YD\_PC\_Futures,YD\_PC\_Options，YD\_PC\_Combination。

int DeliveryYear;

交割年份。

int DeliveryMonth;

交割月份。

int MaxMarketOrderVolume;

市价报单的最大报单量。

int MinMarketOrderVolume;

市价报单的最小报单量。

int MaxLimitOrderVolume;

限价报单的最大报单量。

int MinLimitOrderVolume;

限价报单的最小报单量。

double Tick;

最小变动价位。

int Multiple;

合约单位。

int ExpireDate;

合约到期日。

double StrikePrice;

如果是期货期权合约，表示执行价，否则无意义。

int UnderlyingInstrumentRef

期权标的合约序号

int OptionsType;

期权合约类型：YD\_OT\_NotOption，YD\_OT\_CallOption，YD\_OT\_PutOption。

double UnderlyingMultiply;

期权基础产品的乘数，仅用于期权

int SystemUse7\[32\]

系统字段

bool SingleSideMargin

是否单边计算保证金

char SystemUse6

系统字段

short ExpireTradingDayCount

剩余到期交易日天数

int MarginCalcMethod;

保证金计算方法，仅用于期权  
1 ：中金所股指期权  
2：上交所/深交所ETF期权  
0：其他期权

YDInstrumentID InstrumentHint

合约提示信息，适用于上交所/深交所ETF期权，示例：510050C2009M02350

const YDInstrument \*m\_pUnderlyingInstrument;

如果是期权合约，表示对应基础合约的指针。

const YDExchange \*m\_pExchange;

所属YDExchange的指针。

const YDProduct \*m\_pProduct;

所属YDProduct的指针。

const YDMarketData \*m\_pMarketData;

当前YDMarketData的指针。

mutable void \*pUser;  
mutable double UserFloat;  
mutable int UserInt1;  
mutable int UserInt2;

当使用YDExtendedAPI时，这些字段不可用。

bool AutoSubscribed

是否自动订阅行情

bool UserSubscribed

是否用户订阅行情

bool IsStaticMargin

是否是静态保证金，当MarginBasePriceType为YD\_CBT\_PreSettlementPrice、YD\_CBT\_OpenPrice时，为真，其他为假。

int MarginBasePriceType

成交和持仓合约保证金价格类型，对期货、期权合约有效

int OrderPremiumBasePriceType\[2\]

买卖报单权利金价格类型，仅对期权合约有效

int OrderMarginBasePriceType

报单保证金价格类型，对期货、期权合约有效

int MarginBasePriceAsUnderlyingType

标的合约的保证金价格类型

double MarginBasePrice

当前保证金计算使用的价格

const YDMarginRate \*m\_pExchangeMarginRate\[YD\_MaxHedgeFlag\]

合约交易所保证金率

YDMarketData
------------

行情信息。

**声明**

**说明**

int InstrumentRef

合约序号

int TradingDay;

交易日。

double PreSettlementPrice;

前结算价。

double PreClosePrice;

前收盘价。

double PreOpenInterest;

前持仓量。

double UpperLimitPrice;

涨停板价。

double LowerLimitPrice;

跌停板价。

double LastPrice;

最新价。

double BidPrice;

买入价。为零代表无买入价。

double AskPrice;

卖出价。为零代表无卖出价。

int BidVolume;

买入量。为零代表无买入价。

int AskVolume;

卖出量。为零代表无卖出价。

double Turnover;

成交金额。

double OpenInterest;

持仓量。

int Volume;

成交量。

int TimeStamp;

时间戳，是整数，表示从该交易日开始到此时间的毫秒数。每个交易日从17点开始，即17:00:00对应时间戳0。周一的时间和周六的不区分。

const YDInstrument \*m\_pInstrument

所属YDInstrument的指针。

mutable void \*pUser;  
mutable double UserFloat;  
mutable int UserInt1;  
mutable int UserInt2;

用户自定义字段。当使用YDExtendedAPI时，这些字段不可用。

时间戳表示从该交易日开始到此时间的毫秒数。每个交易日从17点开始，即17:00:00对应时间戳0，之所以如此设计是因为国内的夜盘交易。周五晚上的夜盘交易归属到下个周一，一个周一的交易时段包括三个部分：周五晚上部分（0到25199999），周六凌晨部分（25200000至34199999），周一白天部分（34200000至86399999）。

YDCombPositionDef
-----------------

组合持仓定义。

**声明**

**说明**

YDInstrumentID CombPositionID

组合合约

int CombPositionRef

组合合约序号

int ExchangeRef

交易所序号

int Priority

组合优先级

short CombHedgeFlag

组合套保类型

short CombPositionType

组合持仓类型

const YDExchange \*m\_pExchange

所属YDExchange的指针

const YDInstrument \*m\_pInstrument\[2\]

组合合约两腿合约

int PositionDirection\[2\]

组合合约两腿的持仓方向

int HedgeFlag\[2\]

组合两腿的套保类型

int PositionDate\[2\]

今仓还是历史仓。目前全部为历史仓。

mutable void \*pUser  
mutable double UserFloat  
mutable int UserInt1  
mutable int UserInt2

用户自定义字段

YDAccount
---------

客户/账户资金信息。

**声明**

**说明**

int SystemUse1

系统字段。

int AccountRef

账号序号

YDAccountID AccountID;

账户编码。

double PreBalance;

昨日余额。

double WarningLevel1;

监控终端用的报警线1；超过显示橙色。

double WarningLevel2;

监控终端用的报警线2；超过显示红色。

double MaxMoneyUsage;

资金最大使用率。

double Deposit;

今日入金。

double Withdraw;

进入出金。

double FrozenWithdraw;

冻结出金。期货公司可以先冻结出金，防止客户使用这些资金，然后执行出金，最后取消该冻结。

int TradingRight;

交易权限。

int MaxOrderCount;

最多报单次数。

int MaxLoginCount

最大登录连接数量

int LoginCount

当前登录连接数量

int AccountFlag

账号功能标志

int SystemUse3

系统字段

mutable void \*pUser;  
mutable double UserFloat;  
mutable int UserInt1;  
mutable int UserInt2;

当使用YDExtendedAPI时，这些字段不可用。

注意：客户端需根据报单、成交情况和当前价格自行计算平仓盈亏、期权品种现金出入、手续费、持仓盈亏、已使用保证金、当前余额和可用金额。

YDPrePosition
-------------

客户日初持仓。

**声明**

**说明**

int SystemUse1

系统字段

int AccountRef

账号序号

int InstrumentRef

合约序号

int PositionDirection;

持仓方向。参见PositionDirection

int HedgeFlag;

套保等类型。参见HedgeFlag

int PrePosition;

昨持仓量。

double PreSettlementPrice;

昨结算价。

const YDInstrument \*m\_pInstrument;

所属YDInstrument的指针。

const YDAccount \*m\_pAccount;

所属YDAccount的指针。

YDCombPosition
--------------

组合持仓

**声明**

**说明**

int SystemUse1  
int SystemUse2  
int SystemUse3

系统字段

int AccountRef

账号序号

int CombPositionRef

组合合约序号

int Position

组合持仓量

int CombPositionDetailID

组合持仓明细ID

int SystemUse6

系统字段

YDInputOrder
------------

报单请求。

**声明**

**说明**

int SystemUse1;  
int SystemUse2;  
int SystemUse3;  
int SystemUse4;  
int SystemUse5;

系统字段。

char Direction;

买卖方向：YD\_D\_Buy，YD\_D\_Sell。

char OffsetFlag;

开平仓标志。

char HedgeFlag;

投机套保标志。

char ConnectionSelectionType;

席位连接选择。

union { double Price; struct { int CombPositionDetailID; int SystemUse6; }; }

限价单报单价格；或者在上交所/深交所拆组合的时候设置组合持仓明细ID

int OrderVolume;

报单数量。

int OrderRef;

本账户的报单本地编号。不是ydServer本次运行产生的报单，一律设为-1。

char OrderType;

限价/FAK/市价类型。

char YDOrderFlag;

报单标志。

char ConnectionID;

席位连接编号。

char RealConnectionID;

当使用YD\_CS\_Any和YD\_CS\_Prefered报单时，实际席位连接编号。该字段由易达柜台在委托回报中填写，投资者在报单时不需要设置该字段，填0即可。

int ErrorNo;

如果报单请求被拒绝，表示错误号。否则为0。

报单请求用于普通报单、期权执行宣告、期权放弃自动执行和询价、组合构建和拆分，各字段的填写方法如下所示。注意，下列所有实际不需要的字段，除了期权执行宣告和期权放弃自动执行中的买卖方向外，实际都是要求填为0。所以如果总是先对inputOrder清0，就可以不考虑这些字段。

**报单种类**

**普通报单**

**期权执行宣告**

**期权放弃自动执行**

**询价**

**组合持仓(DCE，SSE，SZSE)**

**YDOrderFlag**

YD\_YOF\_Normal

YD\_YOF\_OptionExecute

YD\_YOF\_OptionAbandonExecute

YD\_YOF\_RequestForQuote

YD\_YOF\_CombPosition

**pInstrument**

必须指定

必须指定

必须指定

必须指定

不存在

**pAccount**

必须指定（可以用NULL表示自己）

必须指定（可以用NULL表示自己）

必须指定（可以用NULL表示自己）

必须指定（可以用NULL表示自己）

必须指定（可以用NULL表示自己）

**OrderType**

必须指定某种报单类型

填YD\_ODT\_Limit

填YD\_ODT\_Limit

填YD\_ODT\_Limit

填0

**Direction**

必须指定某种买卖方向

填YD\_D\_Sell

填YD\_D\_Sell

填YD\_D\_Buy

必须指定建立还是拆分

**OffsetFlag**

必须指定开平方向

必须指定开平方向

必须指定开平方向

填YD\_OF\_Open

填0

**HedgeFlag**

必须指定投保标志

必须指定投保标志

必须指定投保标志

必须指定投保标志

必须指定投保标志

**Price/CombPositionDetailID**

在非市价单的情况下必须指定价格

填0

填0

填0

在上交所/深交所拆分组合时，必须设置CombPositionDetailID，其他时候填0

**OrderVolume**

必须指定报单数量

必须指定执行宣告数量

必须指定放弃自动执行数量

填0

必须指定建立或者拆分数量

**OrderRef**

任意

任意

任意

任意

任意

**ConnectionSelectionType**

必须指定连接选择类型

必须指定连接选择类型

必须指定连接选择类型

必须指定连接选择类型

必须指定连接选择类型

**ConnectionID**

在不是任意连接选择时必须指定

在不是任意连接选择时必须指定

在不是任意连接选择时必须指定

在不是任意连接选择时必须指定

在不是任意连接选择时必须指定

**RealConnectionID**

填0

填0

填0

填0

填0

**ErrorNo**

填0

填0

填0

填0

填0

不同交易所对执行宣告和放弃自动执行有所区别，详情如下。

**交易所**

**期权执行宣告**

**期权放弃自动执行**

SHFE

支持，且总是自动对冲的执行宣告

支持

INE

接口上支持，但是目前不存在此业务

接口上支持，但是目前不存在此业务

CFFEX

不支持

不支持

DCE

支持，我们只调用了交易所ReqTraderOptExec接口，是否自动对冲由交易所决定

不支持（DCE接口中虽然有放弃自动执行，但是实际业务定义不同）

YDOrder
-------

报单回报。

**声明**

**说明**

YDInputOrder

父类。报单请求。

int ExchangeRef

交易所序号

int OrderSysID;

交易所系统报单编号。

int OrderStatus;

报单状态。具体见OrderStatus

int TradeVolume;

报单已成交量。

int InsertTime;

报单插入时间，是整数，表示从该交易日开始到此时间的秒数。每个交易日从17点开始，即17:00:00对应时间戳0。周一的时间和周六的不区分。

int OrderLocalID;

本地报单号，顺序编号，起始值是根据所有席位连接返回的最大本地报单号决定的。不是ydServer本次运行产生的报单，一律设为-1。

YDCancelOrder
-------------

撤单请求。

**声明**

**说明**

int SystemUse1;  
int SystemUse2;  
int SystemUse3;  
int SystemUse4;

系统字段。

int OrderSysID;

交易所系统报单编号。

char SystemUse5;

系统字段。

char ConnectionSelectionType;

席位连接选择。

char ConnectionID;

席位连接编号。

char YDOrderFlag;

报单标志。

撤单请求用于撤销普通报单、撤销期权执行宣告和撤销期权放弃自动执行，各字段的填写方法如下所示。

**报单种类**

**普通报单**

**期权执行宣告**

**期权放弃自动执行**

**YDOrderFlag**

YD\_YOF\_Normal

YD\_YOF\_OptionExecute

YD\_YOF\_OptionAbandonExecute

**pExchange**

必须指定

必须指定

必须指定

**pAccount**

必须指定（可以用NULL表示自己）

必须指定（可以用NULL表示自己）

必须指定（可以用NULL表示自己）

**OrderSysID**

必须指定系统报单号

必须指定系统执行宣告号

必须指定系统放弃自动执行号

**ConnectionSelectionType**

必须指定连接选择类型

必须指定连接选择类型

必须指定连接选择类型

**ConnectionID**

在不是任意连接选择时必须指定

在不是任意连接选择时必须指定

在不是任意连接选择时必须指定

YDFailedCancelOrder
-------------------

撤单失败。

**声明**

**说明**

int SystemUse1  
int SystemUse2  
int SystemUse3

系统字段

int AccountRef

账号序号

YDSysOrderID OrderSysID

交易所系统报单编号

char ExchangeRef

交易所序号

char SystemUse6  
char SystemUse7

系统字段

char YDOrderFlag

报单标志

int ErrorNo

错误原因

int SystemUse8

系统字段

YDTrade
-------

成交回报。

**声明**

**说明**

int SystemUse1;  
int SystemUse2;  
int SystemUse3;

系统字段。

int AccountRef

账号序号

int InstrumentRef

合约序号

char Direction;

买卖方向：YD\_D\_Buy，YD\_D\_Sell。

char OffsetFlag;

开平仓标志。参见OffsetFlag

char HedgeFlag;

投机套保标志。参见HedgeFlag

char SystemUse6;

系统字段。

int TradeID;

交易所成交编号。

int OrderSysID;

交易所系统报单编号。

double Price;

成交价格。

int Volume;

成交量。

int TradeTime;

报单成交时间，是整数，表示从该交易日开始到此时间的数。每个交易日从17点开始，即17:00:00对应时间戳0。周一的时间和周六的不区分。

double Commission;

手续费。

int OrderLocalID;

本地报单号，顺序编号，起始值是根据所有席位连接返回的最大本地报单号决定的。不是ydServer本次运行产生的报单，一律设为-1。

int OrderRef;

本账户的报单本地编号。不是ydServer本次运行产生的报单，一律设为-1。

YDInputQuote
------------

做市商报价。

**声明**

**说明**

int SystemUse1;  
int SystemUse2;  
int SystemUse3;  
int SystemUse4;  
int SystemUse5;

系统字段。

char BidOffsetFlag

买方开平仓标志。必须指定。

char BidHedgeFlag

买方投保标志。必须指定。

char AskOffsetFlag

卖方开平仓标志。必须指定。

char AskHedgeFlag

卖方投保标志。必须指定。

double BidPrice

买方价格。必须指定。

double AskPrice

卖方价格。必须指定。

int BidVolume

买方数量。必须指定。0表示无需买入。

int AskVolume

卖方数量。必须指定。0表示无需卖出。

int OrderRef

本账户的报单本地编号。 报价时，必须指定。 报价回报中，不是ydServer本次运行产生的报单，一律设为-1。

char ConnectionSelectionType;

席位连接选择。参见ConnectionSelection

char ConnectionID;

席位连接编号。

char RealConnectionID;

实际席位连接编号。报价时填0.

char YDQuoteFlag;

报价标志

int Reserved;

系统保留

int ErrorNo;

错误号。如果报单请求被拒绝，表示错误号。否则为0。报单时填0。

对于BidVolume和AskVolume，不同交易所规则不同：

*   对于SHFE和INE，买卖量必须相等，且大于0
*   对于CFFEX，买卖量必须都大于0
*   对于DCE，买卖量至少一个大于0，另一个大于等于0

对于BidHedgeFlag和AskHedgeFlag，不同交易所规则不同：

*   对于CFFEX，交易所接口实际只支持两侧投保标志相同，易达不进行检查，但是报入交易所时使用买入方的投保标志对应的客户号
*   对于SHFE、INE和DCE，买卖方投保标志可以不同

YDQuote
-------

做市商报价回报。

**声明**

**说明**

YDInputQuote

做市商报价。

int ExchangeRef

交易所序号

int QuoteSysID

交易所系统报价编号。

int BidOrderSysID;

买方交易所系统报单编号。

int AskOrderSysID;

卖方交易所系统报单编号。

YDCancelQuote
-------------

做市商撤销报价。

**声明**

**说明**

int SystemUse1;  
int SystemUse2;  
int SystemUse3;  
int SystemUse4;

系统字段。

int QuoteSysID

交易所系统报价编号。必须指定。

char SystemUse5;

系统字段。

char ConnectionSelectionType;

席位连接选择。必须指定。参见ConnectionSelection

char ConnectionID;

席位连接编号。在不是任意连接选择时必须指定。

char SystemUse6

系统字段。

YDFailedCancelQuote
-------------------

做市商撤销报价失败

**声明**

**说明**

int SystemUse1;  
int SystemUse2;  
int SystemUse3;

系统字段。

int AccountRef

账号序号

YDSysOrderID QuoteSysID

交易所系统报价编号

char ExchangeRef

交易所序号

char SystemUse6;  
char SystemUse7;  
char SystemUse8;

系统字段

int ErrorNo

错误原因

int SystemUse9

系统字段

YDRequestForQuote
-----------------

做市商收到的报价请求。

**声明**

**说明**

int SystemUse1;  
int SystemUse2;  
int SystemUse3;  
int SystemUse4;

系统字段。

int InstrumentRef

合约序号

int RequestTime

报价请求时间。

int RequestForQuoteID

询价号。仅对DCE生效。

char SystemUse6;

系统字段。

YDMarginRate
------------

保证金率。

**声明**

**说明**

int SystemUse1;  
int SystemUse2;  
int SystemUse3;  
int SystemUse4;

系统字段。

int HedgeFlag;

投机套保标志。参见HedgeFlag

int SystemUse5;

系统字段。

union {double LongMarginRatioByMoney; double PutMarginRatioByMoney;}

按照金额计算的期货多头或者看跌期权卖方保证金率

union {double LongMarginRatioByVolume; double PutMarginRatioByVolume; double BaseMarginRate;}

按照数量计算的期货多头或者看跌期权卖方保证金; 或者基础保证金率

union {double ShortMarginRatioByMoney; double CallMarginRatioByMoney; double LinearFactor;}

按照金额计算的期货空头或者看涨期权卖方保证金率; 或者线性系数

union {double ShortMarginRatioByVolume; double CallMarginRatioByVolume; double LowerBoundaryCoef;}

按照数量计算的期货空头或者看涨期权卖方保证金；或者最低保障系数

const YDInstrument \*m\_pInstrument;

所属YDInstrument的指针。

const YDProduct \*m\_pProduct;

所属YDProduct的指针。

const YDAccount \*m\_pAccount;

所属YDAccount的指针。

YDCommissionRate
----------------

手续费率。

**声明**

**说明**

int SystemUse1;  
int SystemUse2;  
int SystemUse3;  
int SystemUse4;

系统字段。

int HedgeFlag;

投机套保标志。参见HedgeFlag

int SystemUse5;

系统字段。

double OpenRatioByMoney;

按金额计算的开仓手续费率。

double OpenRatioByVolume;

按数量计算的开仓手续费率。

double CloseRatioByMoney;

按金额计算的平昨手续费率。

double CloseRatioByVolume;

按数量计算的平昨手续费率。

double CloseTodayRatioByMoney;

按金额计算的平今手续费率。

double CloseTodayRatioByVolume;

按数量计算的平今手续费率。

double OrderCommByVolume;

按数量计算的报单手续费率。

double OrderActionCommByVolume;

按数量计算的撤单手续费率。

const YDInstrument \*m\_pInstrument;

所属YDInstrument的指针。

const YDProduct \*m\_pProduct;

所属YDProduct的指针。

const YDAccount \*m\_pAccount;

所属YDAccount的指针。

YDIDFromExchange
----------------

交易所ID类型

**声明**

**说明**

int SystemUse1;  
int SystemUse2;  
int SystemUse3;

系统字段

int AccountRef

账户序号

int ExchangeRef

交易所序号

int IDType

ID类型; 参见IDType

int IDInSystem;

系统内部ID

int SystemUse6

系统字段

char IDFromExchange\[24\]

交易所ID

YDUpdateMarginRate
------------------

更新保证金率

**声明**

**说明**

int SystemUse1;  
int SystemUse2;  
int SystemUse3;

系统字段

int AccountRef

账户序号

int ProductRef

产品序号

int InstrumentRef

合约序号

int UnderlyingInstrumentRef

标的合约序号

int HedgeFlagSet

套保标志集

int ExpireDate

过期日期

int Multiple

合约乘数

int OptionTypeSet

期权类型集合

int SystemUse4

系统字段

union {double LongMarginRatioByMoney; double PutMarginRatioByMoney;}

按照金额计算的期货多头或者看跌期权卖方保证金率

union {double LongMarginRatioByVolume; double PutMarginRatioByVolume; double BaseMarginRate;}

按照数量计算的期货多头或者看跌期权卖方保证金; 或者基础保证金率

union {double ShortMarginRatioByMoney; double CallMarginRatioByMoney; double LinearFactor;}

按照金额计算的期货空头或者看涨期权卖方保证金率; 或者线性系数

union {double ShortMarginRatioByVolume; double CallMarginRatioByVolume; double LowerBoundaryCoef;}

按照数量计算的期货空头或者看涨期权卖方保证金；或者最低保障系数

YDAccountExchangeInfo
---------------------

账户交易所级别信息

**声明**

**说明**

int SystemUse1

系统字段

int AccountRef

账户序号

int ExchangeRef

交易所序号

int TradingRight;

交易所级别交易权限。参见TradeRight

const YDAccount \*m\_pAccount;

所属YDAccount的指针。

const YDExchange \*m\_pExchange;

所属YDExchange的指针。

mutable void \*pUser;  
mutable double UserFloat;  
mutable int UserInt1;  
mutable int UserInt2;

当使用YDExtendedAPI时，这些字段不可用。

YDAccountProductInfo
--------------------

账户产品级别信息

**声明**

**说明**

int SystemUse1

系统字段

int AccountRef

账户序号

int ProductRef

产品序号

int TradingRight;

交易所产品级别交易权限。参见TradeRight

YDTradeConstraint TradingConstraints\[YD\_MaxHedgeFlag\];

产品级别交易限制。参见YDTradeConstraint

const YDAccount \*m\_pAccount;

所属YDAccount的指针。

const YDProduct \*m\_pProduct;

所属YDProduct的指针。

mutable void \*pUser;  
mutable double UserFloat;  
mutable int UserInt1;  
mutable int UserInt2;

当使用YDExtendedAPI时，这些字段不可用。

YDAccountInstrumentInfo
-----------------------

账户合约级别信息

**声明**

**说明**

int SystemUse1

系统字段

int AccountRef

账户序号

int InstrumentRef

合约序号

int TradingRight;

交易所合约级别交易权限。参见TradeRight

YDTradeConstraint TradingConstraints\[YD\_MaxHedgeFlag\];

合约级别交易限制。参见YDTradeConstraint

const YDAccount \*m\_pAccount;

所属YDAccount的指针。

const YDInstrument \*m\_pInstrument;

所属YDInstrument的指针。

const YDMarginRate  
\*m\_pMarginRate\[YD\_MaxHedgeFlag\];

到投保等类型的保证金率的指针。

const YDCommissionRate  
\*m\_pCommissionRate\[YD\_MaxHedgeFlag\];

到投保等类型的手续费率的指针。

mutable void \*pUser;  
mutable double UserFloat;  
mutable int UserInt1;  
mutable int UserInt2;

当使用YDExtendedAPI时，这些字段不可用。

YDGeneralRiskParam
------------------

通用的风险参数

**声明**

**说明**

int SystemUse1;  
int SystemUse2;  
int SystemUse3;

系统字段

int AccountRef

账户序号

int GeneralRiskParamType

通用风险参数类型，参见GeneralRiskParamType

int ExtendedRef

扩展序号

double FloatValue

浮点值

int IntValue1

整型值1

int IntValue2

整型值2

YDExtendedOrder
---------------

扩展的报单信息。YDExtenderOrder是YDOrder的子类，增加的字段如下：

**声明**

**说明**

union { const YDInstrument \*m\_pInstrument; const YDCombPositionDef \*m\_pCombPositionDef; };

指向报单的合约对象或者组合持仓定义的指针。

const YDAccount \*m\_pAccount;

指向报单的账户对象的指针。

const YDInstrument \*m\_pInstrument2;

指向报单的合约对象2的指针。

YDExtendedTrade
---------------

扩展的报单信息。YDExtenderTrade是YDTrade的子类，增加的字段如下：

**声明**

**说明**

const YDInstrument \*m\_pInstrument

指向报单的合约对象的指针。参见YDInstrument

const YDAccount \*m\_pAccount;

指向报单的账户对象的指针。参见YDAccount

YDExtendedQuote
---------------

扩展的报价信息。YDExtenderQuote是YDQuote的子类，增加的字段如下：

**声明**

**说明**

bool BidOrderFinished

买方报单是否完成

bool AskOrderFinished

卖方报单是否完成

const YDInstrument \*m\_pInstrument

指向报单的合约对象的指针。参见YDInstrument

const YDAccount \*m\_pAccount;

指向报单的账户对象的指针。参见YDAccount

YDExtendedRequestForQuote
-------------------------

扩展的报价请求信息。YDExtenderRequestForQuote是YDRequestForQuote的子类，增加的字段如下：

**声明**

**说明**

const YDInstrument \*m\_pInstrument

指向报单的合约对象的指针。参见YDInstrument

YDExtendedAccount
-----------------

扩展账户信息

**声明**

**说明**

double CloseProfit

平仓盈亏

double CashIn

权利金

double OtherCloseProfit

所有非期货品种的平仓盈亏

double Commission

手续费

double Margin

保证金

double PositionProfit

持仓盈亏

double Balance

资金余额

double Available

可用资金（不计入持仓亏损部分）

unsigned UsedOrderCount

用户报单数

int Useless

保留字段

const YDAccount \*m\_pAccount

指向用户的YDAccount结构

double ExecMargin

期权执行保证金

double OptionLongPositionCost

权利仓持仓张数

double OptionLongPositionCostLimit

权利仓持仓限额

double useable(void) const

可用资金（计入持仓亏损部分）

bool canUse(double value) const

判断可用资金是否足够

YDExtendedPosition
------------------

扩展持仓信息

**声明**

**说明**

int PositionDate

今仓还是历史仓，今仓仅适用于SHFE和INE

int PositionDirection

持仓方向

int HedgeFlag

套保标志

int OpenFrozen

开仓冻结量

int Position

持仓量

int PositionByOrder

根据报单回报计算的持仓量

int YDPositionForCommission

用于计算手续费的昨持仓量。YDPositionForCommission<=Position永远成立  
对于SHFE和INE：  
若PositionDate为今仓，则YDPositionForCommission永远为0  
若PositionDate为昨仓，则YDPositionForCommission永远等于Position  
对于其他交易所，YDPositionForCommission可能大于0且小于Position

int CloseFrozen

平仓冻结量

int PossibleOpenVolume

可能的总开仓量

int ExecFrozen

执行冻结量

double TotalOpenPrice

总开仓金额

double Margin

保证金

double PositionProfit

持仓盈亏

double MarginPerLot

按照昨结算价计算的合约单手保证金

double CloseProfit

平仓盈亏

double OtherCloseProfit

所有非期货品种的平仓盈亏，如期权

const YDAccountInstrumentInfo \*m\_pAccountInstrumentInfo

指向YDAccountInstrumentInfo结构

CPositionDetail \*PositionDetailList

用于计算盈亏的持仓明细链表

void \*Padding1

占位符

int TotalCombPositions

本持仓参与组合持仓的手数

int Padding2

占位符

unsigned CombPositionCount

组合持仓记录条数

const YDAccount \*getAccount(void) const

获得当前持仓所属账户

const YDInstrument \*getInstrument(void) const

获得当前持仓的合约

const YDMarginRate \*getMarginRate(void) const

获得当前持仓的保证金率

const YDCommissionRate \*getCommissionRate(void) const

获得当前持仓的手续费率

double OpenPrice(void) const

获得当前持仓的开仓均价，改方法后续版本将删除，请使用getOpenPrice。

double getOpenPrice(void) const

获得当前持仓的开仓均价

int getYDPosition() const

获得昨持仓

### CPositionDetail

**声明**

**说明**

CPositionDetail \*m\_pNext

指向链表中下一个持仓明细

double Price

开仓价格

int Volume

持仓明细数量

int TradeID

成交编号，当TradeID小于0时，代表昨仓，昨仓只会出现在链表的第一个

CCZCECombPosition\* m\_pCZCECombPosition

郑商所组合持仓

YDExtendedCombPositionDetail
----------------------------

扩展组合持仓明细

**声明**

**说明**

const YDAccount \*m\_pAccount

账户

const YDCombPositionDef \*m\_pCombPositionDef

组合持仓定义

int Position

持仓量

int CombPositionDetailID

组合持仓明细ID

YDExtendedPositionFilter
------------------------

查询扩展持仓信息的过滤器

**声明**

**说明**

int PositionDate

持仓日期，-1表示所有

int PositionDirection

持仓方向，-1表示所有

int HedgeFlag

套保标志，-1表示所有

const YDInstrument \*pInstrument

指向合约结构的指针，空指针表示所有

const YDProduct \*pProduct

指向品种结构的指针，空指针表示所有

const YDExchange \*pExchange

指向交易所结构的指针，空指针表示所有

const YDAccount \*pAccount

指向账户结构的指针，空指针表示所有

YDOrderFilter
-------------

查询报单信息的过滤器

**声明**

**说明**

int StartTime

开始时间，-1表示所有，此参数可以用函数string2TimeID()从字符串表示的时间生成。

int EndTime

结束时间，-1表示所有，此参数可以用函数string2TimeID()从字符串表示的时间生成。

int YDOrderFlags

可以通过按位与的方式设置YDOrderFlag的组合。例如要搜索YD\_YOF\_QuoteDerived的委托，那么YDOrderFlags=1<<YD\_YOF\_QuoteDerived

const YDCombPositionDef\* pCombPositionDef

指向组合持仓定义结构的指针，空指针表示所有

const YDInstrument \*pInstrument

指向合约结构的指针，空指针表示所有

const YDProduct \*pProduct

指向品种结构的指针，空指针表示所有

const YDExchange \*pExchange

指向交易所结构的指针，空指针表示所有

const YDAccount \*pAccount

指向账户结构的指针，空指针表示所有

YDQuoteFilter
-------------

查询报价信息的过滤器

**声明**

**说明**

const YDInstrument \*pInstrument

指向合约结构的指针，空指针表示所有

const YDProduct \*pProduct

指向品种结构的指针，空指针表示所有

const YDExchange \*pExchange

指向交易所结构的指针，空指针表示所有

const YDAccount \*pAccount

指向账户结构的指针，空指针表示所有

YDTradeFilter
-------------

查询报单信息的过滤器

**声明**

**说明**

int StartTime

开始时间，-1表示所有，此参数可以用函数string2TimeID()从字符串表示的时间生成。

int EndTime

结束时间，-1表示所有，此参数可以用函数string2TimeID()从字符串表示的时间生成。

const YDInstrument \*pInstrument

指向合约结构的指针，空指针表示所有

const YDProduct \*pProduct

指向品种结构的指针，空指针表示所有

const YDExchange \*pExchange

指向交易所结构的指针，空指针表示所有

const YDAccount \*pAccount

指向账户结构的指针，空指针表示所有

YDCombPositionDetailFilter
--------------------------

查询组合持仓明细的过滤器

**声明**

**说明**

const YDCombPositionDef \*pCombPositionDef

组合持仓定义，空指针表示所有

const YDAccount \*pAccount

指向账户结构的指针，空指针表示所有

const YDInstrument \*pInstrument

指向合约结构的指针，空指针表示所有; 如果非空，组合持仓两腿必须满足一腿

int PositionDirection

持仓方向，0表示所有方向；如果指定了持仓方向，组合持仓两腿必须满足一腿

bool IncludeSplit

是否包括已经拆分了的组合持仓

API
===

基于ydApi编写客户端应用程序接口方面主要包括两个部分：一是扩展YDListener基类的回调函数，接收ydServer推送的交易信息，调整自身的业务策略，发现交易机会并尝试交易。第二就是ydApi初始化。

ydApi初始化就三个步骤。第一步生成实现YDAPI基类的实例；第二步调用new生成扩展后的YDListener类的实例；第三步调用用YDAPi::start方法，把YDApi实例和YDListener实例相互关联起来，启动内部管理线程和网络通信线程。

API的选择
------

易达提供了两种API类型，ydApi和ydExtendedApi。其中，ydApi具有极高的性能，但需要用户自行维护钱仓；ydExtendedApi帮助用户管钱管仓，但是有一定的性能开销。用户可以根据自身的实际需要选择不同的API。

使用ydExtendedApi时，可以从getExtendedAccount获取可用资金，通过getExtendedPosition和findExtendedPositions获取当前持仓，报单仍然使用从ydApi继承的insertOrder以获取高速报单性能。但是由于ydExtendedApi需要计算钱仓，因此相比ydApi直接返回回报相比，是有一定的性能开销的。

多连接的注意事项
--------

易达系统在设计开发时并没有对多连接进行特别的优化，但是仍然有不少投资者在生产中创建多个易达API实例以实现多账户同时交易的功能，为了避免误用导致损失，请在单进程使用多个API实例时注意以下问题：

*   不要混用不同API实例中的指针，例如不要将某个API实例中获得的合约指针用于其他API实例的报单，否则会导致不可预知的问题，影响正常交易。
*   易达没有提供连接编号，用户可以通过OrderRef来区分，例如可以用OrderRef中最后3个bit来表示最多8个不同的连接。

全局函数
----

### makeYDApi

    YDApi *makeYDApi(const char *configFilename)

参数为网络通信和CPU/Core绑定关系的配置文件。

该函数向操作系统申请空间生成实现YDApi类的实例，解析配置文件，之后将返回新申请的YDApi实现类的实例。

### makeYDExtendedApi

    YDExtendedApi *makeYDExtendedApi(const char *configFilename)

参数为网络通信和CPU/Core绑定关系的配置文件。

该函数向操作系统申请空间生成实现YDExtendedApi类的实例，解析配置文件，之后将返回新申请的YDApi实现类的实例。

### getYDVersion

    const char *getYDVersion(void)

获取当前API的版本，通常是一个四段版本号。

### getYDNanoTimestamp

    unsigned long long getYDNanoTimestamp()

精确和开销极少的获取时间戳的方法，可以通过前后取两个时间戳计算时间差，单位为纳秒。投资者可以用来测试API报单的耗时等。

YDListener类
-----------

YDListener代表了一组监听网络通信的线程。根据配置文件的不同，线程数量也不相同，但至少包括一个接收ydServer下行信息的TCP交易回报接收线程；如果使用ydServer发布的行情数据（MarketData），则需要增加一至两个线程。这些线程接收下行信息后维护本地的初始数据库，并且调用继承类中相应的notify回调函数以通知客户端。

### notifyBeforeApiDestory

    virtual void notifyBeforeApiDestory(void)

在调用startDestory之后，在清理数据之前调用的回调。

### notifyAfterApiDestory

    virtual void notifyAfterApiDestory(void)

在调用startDestory之后，且清理完成数据之后的回调。

### notifyEvent

    virtual void notifyEvent(int apiEvent)

当TCP交易连接成功、断线，TCP行情连接成功、断线，探测到易达服务端重启后，会通过本回调函数通知到投资者。

特别的，当收到YD\_AE\_ServerRestarted消息时，如果不做任何处理，后续API会使得进程退出，如果此时不希望进程退出的，可以调用startDestory主动摧毁ydApi对象。

### notifyReadyForLogin

    virtual void notifyReadyForLogin(bool hasLoginFailed)；

客户端完成与ydServer的网络连接后ydApi将回调notifyReadyForLogin，表示已完成与ydServer的TCP网络连接，可以准备登录了。

这个函数带有一个参数hasLoginFailed，表示客户端前次的登录是否失败。如果客户端之前登录过系统，且登录失败，则ydApi会主动延迟三秒之后调用notifyReadyForLogin，并且置位hasLoginFailed为true。注意：YDApi类的同一实例不支持客户端程序在运行过程改变用户名，也就是说在同一次运行中需保持用户名不变。

### notifyLogin

    virtual void notifyLogin(int errorNo, int maxOrderRef, bool isMonitor)；

登录请求发送后ydServer将校验用户名与口令是否正确，并且将登录结果下行发送给客户端，由ydApi回调notifyLogin。参数errorNo代表是否登录成功。如果成功，参数isMonitor代表是否系统管理员；若为管理员，参数maxOrderRef设置为0。

参数maxOrderRef表示客户端单个交易日内使用过的最大本地报单编号。ydServer允许使用同一用户名/口令客户端多次登录，但客户端需要使用某种机制确保本地报单编号不发生重复，比如奇偶交替并单项递增。

### notifyFinishInit

    virtual void notifyFinishInit(void)；

通知客户端接收ydServer推送的初始化数据完成，客户端运行期间仅会被回调一次。如果没有报单和成交回报（比如夜盘交易的首次运行），客户端程序可以在此启动日初逻辑。之后如果调用YDApi::hasFinishedInit()将返回true，在此之前调用返回false。初始数据库内容可以安全使用，其用户自定义字段均复位为0。

此时本地的初始数据库中的数据记录全部就绪，完成了所需内存的申请和设置，客户端可以通过YDApi类中的getX()方法获取数据, 获取的地址不会发生改变，因此客户端程序可以放心使用指针。但是交易过程中的保证金、手续费、可用资金和持仓等数据仍然需要客户端根据报单/成交通知情况自行计算。也就是说本地交易数据库中记录的是日初静态初始化数据，以及交易盘后交易管理员设置出入金和交易权限调整。

客户端程序在其一次运行内只会发生一次notifyFinishInit回调，即使发生了断线重连，重连后也不再有回调，因为ydServer没有重启，包括日初静态数据和报单成交回报在内的流水未发生变化，重连后无需再次初始化静态数据。因此该方法是初始化客户业务数据的合适之处。

### notifyCaughtUp

    virtual void notifyCaughtUp(void)；

通知客户端接收ydServer推送的当前交易日内以前的报单和成交回报接收完成。此回调一定在notifyFinishInit之后。客户端程序如果发生断线重连，则每次重连都会收到notifyCaughtUp回调。

### notifyTradingSegment

    virtual void notifyTradingSegment(const YDExchange *pExchange, int segmentTime)；

通知客户端接收到交易所发布的交易状态变化。为了减少通讯量，ydServer仅通知客户端交易所发布状态变化的时刻，segmentTime表示从该交易日开始到此时间的秒数。每个交易日从17点开始，即17:00:00对应时间戳0。考虑到夜盘交易，周一的时间和周六的不区分。

下面列出了目前各个交易所的交易状态变化时间供参考，若交易所有变化恕不另行通知，请以生产中接收到的实际时间为准。

**交易所**

**日盘**

**夜盘**

中金所

09:25:00  
09:29:00  
09:30:00  
11:30:00  
13:00:00  
14:57:00  
15:00:00  
15:15:00

能源所

09:00:00  
10:15:00  
10:30:00  
11:30:00  
13:30:00  
15:00:00

20:55:00  
20:59:00  
21:00:00  
23:00:00  
01:00:00  
02:30:00

上期所

08:55:00  
08:59:00  
09:00:00  
10:15:00  
10:30:00  
11:30:00  
13:30:00  
15:00:00

20:55:00  
20:59:00  
21:00:00  
23:00:00  
01:00:00  
02:30:00

大商所

08:54:50  
08:55:00  
08:58:50  
08:59:00  
08:59:50  
09:00:00  
10:14:50  
10:15:00  
10:29:50  
10:30:00  
11:29:50  
11:30:00  
13:29:50  
13:30:00  
14:59:50  
15:00:00

20:54:50  
20:55:00  
20:58:50  
20:59:00  
20:59:50  
21:00:00  
22:59:50  
23:00:00

### notifyCombPosition

    virtual void notifyCombPosition(const YDCombPosition *pCombPosition,const YDCombPositionDef *pCombPositionDef,const YDAccount *pAccount)

在notifyFinishInit和notifyCaughtUp之间，接收当前的组合持仓，用于启动的初始化。

### notifyOrder和notifyFailedOrder

    virtual void notifyOrder(const YDOrder *pOrder, const YDInstrument *pInstrument, const YDAccount *pAccount)；
    virtual void notifyFailedOrder(const YDInputOrder *pFailedOrder, const YDInstrument *pInstrument, const YDAccount *pAccount)；

获取报单回报，对于YDApi::insertOrder和YDApi::cancelOrder请求，均使用上述两个回调函数来获取处理结果，由柜台返回的错单（失败的原因既可能是未通过ydServer的风控）通过notifyFailedOrder返回，由交易所返回的正确报单或错单通过notifyOrder返回。

ydServer对所有连接的席位使用统一的本地报单编号。比如当前系统的本地报单编号为100。此时收到一笔报单请求，通过校验后，其本地编号为101，使用席位0送入交易所；接着又收到一笔报单请求，则其本地报单编号为102，使用席位1送入交易所。

ydServer通过交易所私有流接收期货公司的报单和成交回报，可能接收到来自于其他系统的报单和成交回报，为了防止混淆，这些报单的本地报单编号一概设置为-1。如果ydServer发生故障并重启，之前ydServer运行实例产生的报单其本地报单编号也设置为-1。

如果报单被交易所拒绝，pOrder->ErrorNo包含了交易所的错误代码；如果报单未被交易所拒绝，其值为0。

收到的回报的序列各个交易所并不相同。对于限价单，每个交易所都会先有一个YD\_OS\_Queuing的回报，然后随着成交或者投资者发起撤单有相应的回报。对于FAK/FOK/市价单，大商所会先发一个YD\_OS\_Queuing的回报，几乎同时会有一个YD\_OS\_Canceled或者YD\_OS\_AllTraded的回报；而其他交易所只会有一个YD\_OS\_Canceled或者YD\_OS\_AllTraded的回报。

### notifyFailedCancelOrder

    virtual void notifyFailedCancelOrder(const YDFailedCancelOrder *pFailedCancelOrder,const YDExchange *pExchange,const YDAccount *pAccount)

取消订单被拒绝时，生成notifyFailedCancelOrder。

### notifyTrade

    virtual void notifyTrade(const YDTrade *pTrade, const YDInstrument *pInstrument, const YDAccount *pAccount)；

获取成交回报。

### notifyQuote

    virtual void notifyQuote(const YDQuote *pQuote, const YDInstrument *pInstrument, const YDAccount *pAccount)

获取报价回报。

### notifyFailedQuote

    virtual void notifyFailedQuote(const YDInputQuote *pFailedQuote, const YDInstrument *pInstrument, const YDAccount *pAccount)

获取错误的报价回报。

### notifyFailedCancelQuote

    virtual void notifyFailedCancelQuote(const YDFailedCancelQuote *pFailedCancelQuote,const YDExchange *pExchange,const YDAccount *pAccount)

获取错误的报价回报。

### notifyRequestForQuote

    virtual void notifyRequestForQuote(const YDRequestForQuote *pRequestForQuote,const YDInstrument *pInstrument)

获取报价请求。

### notifyCombPositionOrder和notifyFailedCombPositionOrder

    virtual void notifyCombPositionOrder(const YDOrder *pOrder,const YDCombPositionDef *pCombPositionDef,const YDAccount *pAccount)
    virtual void notifyFailedCombPositionOrder(const YDInputOrder *pFailedOrder,const YDCombPositionDef *pCombPositionDef,const YDAccount *pAccount)

获取组合持仓YDApi:: insertCombPositionOrder、YDExtendedAPI:: checkAndInsertCombPositionOrder的回报。

如果客户组合持仓的报单被交易所接受，回报会通过notifyCombPositionOrder返回，只会有一个回报，其中OrderStatus为YD\_OS\_AllTraded，一定有OrderSysID，TradeVolume一定等于OrderVolume。

如果客户组合持仓的报单被易达拒绝，回报会通过notifyFailedCombPositionOrder返回，ErrorNo中包含了易达的错误号。

如果客户组合持仓的报单被交易所拒绝，回报会通过notifyCombPositionOrder返回，只会有一个回报，ErrorNo中有交易所的错误号+1000，OrderStatus为YD\_OS\_Rejected，没有OrderSysID。

### notifyOptionExecTogetherOrder和notifyFailedOptionExecTogetherOrder

    virtual void notifyOptionExecTogetherOrder(const YDOrder *pOrder,const YDInstrument *pInstrument,const YDInstrument *pInstrument2,const YDAccount *pAccount)
    virtual void notifyFailedOptionExecTogetherOrder(const YDInputOrder *pFailedOrder,const YDInstrument *pInstrument,const YDInstrument *pInstrument2, const YDAccount *pAccount)

合并行权YDApi::insertOptionExecTogetherOrder的回报。

如果客户合并行权时的报单被交易所接受或拒绝，回报会通过notifyOptionExecTogetherOrder返回。

如果客户合并行权时的报单被易达拒绝，回报会通过notifyFailedOptionExecTogetherOrder返回，ErrorNo中包含了易达的错误号。

### notifyMarketData

    virtual void notifyMarketData(const YDMarketData *pMarketData)；

获取行情。

### notifyAccount

    virtual void notifyAccount(const YDAccount *pAccount)；

当账户信息发生改变时通知。目前，YDAccount中的MaxMoneyUsage、Deposit、Withdraw、FrozenWithdraw、TradingRight、LoginCount发生变化时，会触发回调通知。

### notifyAccountXXXInfo

    
    virtual void notifyAccountExchangeInfo(const YDAccountExchangeInfo *pAccountExchangeInfo)；
    virtual void notifyAccountProductInfo(const YDAccountProductInfo *pAccountProductInfo)；
    virtual void notifyAccountInstrumentInfo(const YDAccountInstrumentInfo *pAccountInstrumentInfo)；
    

获取交易权限信息。

### notifyIDFromExchange

    virtual void notifyIDFromExchange(const YDIDFromExchange *pIDFromExchange,const YDExchange *pExchange)

获取交易所SysID的回报。

### notifyUpdateMarginRate

    virtual void notifyUpdateMarginRate(const YDUpdateMarginRate *pUpdateMarginRate)

修改保证金率的回报。

### notifyChangePassword

    virtual void notifyChangePassword(int errorNo)；

获取修改口令回报。errorNo如果为0，代表口令修改成功；否则失败。系统管理员也可以修改客户口令。

### notifyResponse

    virtual void notifyResponse(int errorNo,int requestType)；

接受错误代码和引起错误的请求类型

### notifyRecalcTime

    virtual void notifyRecalcTime(void)

重算时间回调；在使用YDApi时，这是建议进行保证金和持仓盈亏计算的时点；在使用YDExtendedApi时，这是每一次自动重算保证金和持仓盈亏以后的回调。

YDApi
-----

YDApi类向客户端提供了三类接口方法：

*   启动ydApi；
*   与ydServer通信和发送业务请求；
*   查询初始数据库；

### start

    virtual bool start(YDListener *pListener)=0;

参数为YDListener基类的指针。如果返回false，说明配置文件有问题。

该方法实现了YDApi实例与YDListener相互关联以便YDApi的初始化数据库和内部管理服务共享。之后启动内部管理线程，根据配置文件中内容启动YDListener需要的线程以监听网络通信。理论上ydApi支持同一客户端程序中有多个YDApi/YDListener实例，甚至两个YDApi实例共享同一个YDListener实例，但我们不推荐这样的开发模式，因为其内部数据同步逻辑将会非常复杂。

### startDestroy

    virtual void startDestroy(void)=0

调用此方法后，api将尝试关闭所有连接并停止所有属于该api的线程。

在此期间，不能再使用所有交易功能，也不会收到任何交易通知，但是仍然可以使用所有获取数据的功能。在此期间结束时，notifyBeforeApiDestroy将被发送给listener。然后开始第二阶段以释放api的所有数据结构。api的所有功能在此期间不能使用，并且api给定的所有数据指针不再有效。在第二个阶段结束时，notifyAfterApiDestroy将发送给listener，表明api的所有资源都已释放。

永远不要尝试删除api，但是listener本身应由用户删除。

### disconnect

    virtual void disconnect(void)=0;

断开与ydServer的通信连接。

### login

    virtual bool login(const char *username, const char *password， const char *appID, const char *authCode)=0;

向ydServer发送登录请求。如果无法网络发送则返回false，说明发生了网络断链。ydServer的处理结果通过YDListener::notifyLogin回调函数获得。

ydServer每次启动均生成唯一的运行实例号。客户端每次登录时ydApi会记录此实例号。断线重连并登录成功后会在登录响应报文中获得ydServer的运行实例号，如果发现不一致则会直接退出客户端的程序运行。由于ydServer重启后，客户的流水序列和流水号会发生变化，因此，客户端需要重新登录并同步所有数据，完成数据初始化。客户端应用需要监测自己的应用状态，一旦发现ydServer重启，自行确定是否重启应用，如果重启需做好数据同步和初始化工作。

#### 用户端应用授权码

向ydServer发送登录请求。如果无法网络发送则返回false，说明发生了网络断链。ydServer的处理结果通过YDListener::notifyLogin回调函数获得。在客户端软件开发和测试阶段可以用以下“开发授权码”。

    //测试用开发授权码
    #define APP_ID "ydDev 1.0"
    #define AUTH_CODE "9ba749b1e1848a32ba67182c5ffee0fe"

上线运行前需向期货公司提交APP\_ID，经其认证后将颁发正式的授权码，并用新的APP\_ID和AUTH\_CODE登录生产环境。

### insertOrder

    virtual bool insertOrder(YDInputOrder *pInputOrder,const YDInstrument *pInstrument, const YDAccount *pAccount=0)=0;

向ydServer发送报单请求。如果无法网络发送则返回false，说明发生了网络断链。ydServer的处理结果通过YDListener::notifyOrder或者YDListener::notifyFailedOrder回调函数获得。YDListener::notifyOrder对应于柜台报单成功，但仍然有可能被交易所拒绝而产生失败的报单回报，因此被本回调返回的报单回报需要判断ErrorNo；YDListener::notifyFailedOrder对应于柜台报单失败，通常是无法通过柜台的风控而产生的错单回报。对于因交易所断线、流控等因素，无法送达交易所的报单和报价，其处理过程等同于被交易所拒绝。

由于席位连接断线或者流控等原因，报单和撤单请求可能失败，ydServer将向客户端返回失败，对于报单请求，其报单状态变为YD\_OS\_Rejected，并且设置ErrorNo。

需要注意的是该方法有两个参数，一是报单记录，二是初始数据库中合约记录指针，这与市场上的其他交易系统有明显的不同。之所以如此设计，是为了减少字符串拷贝和比较，提高系统执行效率。为此，对于业务需要使用到的合约，我们建议客户端程序设计人员在调用getInstrumentByID()后将其指针缓存下来以减少字符串比较操作。

#### 报单状态和处理过程

报单送入ydServer后，如果没有通过风控或流控检查，其状态将变成YD\_OS\_Rejected，客户端会收到YDListener::notifyFailedOrder回调。如果ydServer发生故障后重启，此报单请求记录将消失。

报单送入ydServer并且通过风控和流控检查后将进入YD\_OS\_Accepted状态，该状态不会送给客户端；ydServer将该报单请求送往交易所并等待交易所回报。

收到交易所回报后，如果报单通过交易所校验，将变成有效报单，状态转为YD\_OS\_Queueing（该报单被交易所确认并被ydServer记录在持久流水中，即使ydServer发生故障重启也不会丢失），向客户端发送YDListener::notifyOrder回调。如果报单未通过交易所校验，其状态将变成YD\_OS\_Rejected，客户端会收到YDListener::notifyOrder回调，但其状态为YD\_OS\_Rejected，如果ydServer发生故障后重启，此报单请求记录将消失。

YD\_OS\_Queueing状态的报单可能完全成交、部分成交或者完全未成交，可通过各个随后的YDListener::notifyOrder回调中的YDOrder::TradeVolume字段来判定。

如果期间发生成交，客户将收到YDListener::notifyOrder和YDListener::notifyTrade回调；若有多次成交，将会收到多次报单和成交回调。YDOrder::TradeVolume字段的值将随着成交的增加而增加，比如一张报单成功申报了3手，申报时未成交且在交易所撮合队列中排队，则第一次YDListener::notifyOrder报文的YDOrder::TradeVolume字段值为0，一分钟后分成三次成交，每次1手，之后的三次回调的YDOrder::TradeVolume字段依次分别为1，2，3。

如果报单处于YD\_OS\_Queueing状态，客户可以提交撤单请求。经交易所处理后如果撤单成功客户将会收到YDListener::notifyOrder回调，其状态变为YD\_OS\_Canceled，之后其状态不会发生变更。对于FAK类或市价类报单，交易所系统会主动撤销报单，客户端也会收到YDListener::notifyOrder回调。如果报单无法撤销，客户端将不会收到任何回报，这说明交易所端不允许撤销此报单，原因可能是已经撤销、已经完全成交，也可能是网络通讯故障。

如果报单完全成交，其状态变为YD\_OS\_AllTraded，之后其状态不会发生变更。

#### 交易权限

系统缺省允许账户交易，也就是说如果不设置YD\_TR\_CloseOnly和YD\_TR\_Forbidden，即使不设置YD\_TR\_Allow，ydServer也允许此账户交易。不管如何设置，ydServer总是允许客户删除自己的报单。ydServer检查权限时是按照账号、合约、产品和交易所的顺序依次检查，只要一项不允许交易，客户则不能报单；只要其中一项不允许开仓，客户则只能平仓。

#### 报单编号OrderRef

对于每次易达系统运行的每个客户，OrderRef分别管理的。每次客户登录，会得到当时的所有报单和报价中的OrderRef的最大值。如果客户还没有报过单，会给出0。建议客户的自动交易系统总是从登录时获得的MaxOrderRef的下一个数开始，依次给所有的报单和报价编号。

对于易达系统的报单和报价，所有返回的信息中都会填写客户提交时的OrderRef，易达不进行任何唯一性或者单调性检查；对于报价派生的报单，报单中的OrderRef会与报价中的相同；对于非易达系统的报单和报价，或者非本次易达服务器运行时报入的报单和报价，所有返回信息中的OrderRef一律是-1；使用YDClient给出的所有报单和报价，OrderRef一律是0。

#### 席位连接编号

客户端程序可使用YDAPI类的getExchange或者getExchangeByID方法获取YDExchange的指针，其ConnectionCount字段中标明了席位连接数量。注意，席位连接从0开始编号，依次递增，直至ConnectionCount-1为止。

交易所要求柜台系统通过FENS接入交易所，而FENS分配的前置机有随机性，因此ydServer不同运行实例号的同一个席位可能连接到交易所的不同前置机；即使是同一次运行，仍然可能因为断线重连的原因连接到不同的前置机。

#### 席位选择

YD\_CS\_Any为未指定席位连接，ydServer将根据现有席位连接情况尽快将报单请求或撤单请求送入交易所，如果所有席位因流控或断链等原因不可用，ydServer将通过YDListener::notifyOrder返回错误回报。

YD\_CS\_Fixed为指定交易所席位连接，如果该席位因流控或断链等原因不可用，ydServer将立即返回错误信息；若报单时该席位在报送其他订单，系统会等待最长不超过200毫秒的时间，若超过时间则会通过YDListener::notifyOrder返回错误回报。

YD\_CS\_Prefered指定交易所席位连接，如果该席位因流控、断链或者正在处理其他报单，则退化为“YD\_CS\_Any”模式，由系统选择最合适的席位报单。

#### 错误编码

ErrorNo字段在报单时不需要，直接设置为0。

### cancelOrder

    virtual bool cancelOrder(YDCancelOrder *pCancelOrder,const YDExchange *pExchange, const YDAccount *pAccount=0)=0;

向ydServer发送撤单请求。如果无法网络发送则返回false，说明发生了网络断链。ydServer的处理结果通过YDListener::notifyOrder回调函数获得。如果报单状态变为YD\_OS\_Canceled，说明撤单成功。其他状态或者未收到回调，说明撤单失败。投资者应该设定一定的超时时间，如果超时时间内订单状态没有发生变化，应该继续撤单。

注意，正确的撤单请求的回报通过YDListener:notifyOrder回调返回，错误的撤单请求通过YDListener:notifyFailedCancelOrder返回。

### insertQuote

    virtual bool insertQuote(YDInputQuote *pInputQuote,const YDInstrument *pInstrument, const YDAccount *pAccount=NULL)=0;

向ydServer发送报价请求。如果无法发送则返回false，说明发生了网络断链。

若报价成功，同时会有一个YDListener::notifyQuote回调和可能有多个YDListener::notifyOrder回调：

*   YDListener::notifyQuote中一定有QuoteSysID，如果有买单则一定有BidOrderSysID，如果有卖单则一定有AskOrderSysID。
*   YDListener::notifyOrder可能有多个，每张报价派生的买卖报单会分别给出，notifyOrder返回的委托回报的YDOrderFlag一定是YD\_YOF\_QuoteDerived，该委托允许撤单。OrderRef和报价中的相同，notifyOrder和notifyQuote之间的次序不保证。

若报单失败，则分为两种情况：

*   如果报价没有通过柜台的风控，则会通过YDListener::notifyFailedQuote回调返回，每张报价单只会有一次回调，ErrorNo中可获得错误号。
*   如果报价是被交易所拒绝，则会通过YDListener::notifyQuote回调返回，此时ErrorNo中有交易所的错误号+1000，但是没有QuoteSysID。

### cancelQuote

    virtual bool cancelQuote(YDCancelQuote *pCancelQuote,const YDExchange *pExchange, const YDAccount *pAccount=NULL)=0;

向ydServer发送报价请求。如果无法发送则返回false，说明发生了网络断链。

ydServer的处理结果通过YDListener::notifyOrder回调函数获得，每张还在挂单的报单一个，如果报单状态变为YD\_OS\_Canceled，说明撤单成功。其他状态或者未收到回调，说明撤单失败。

### insertCombPositionOrder

    virtual bool insertCombPositionOrder(YDInputOrder *pInputOrder,const YDCombPositionDef *pCombPositionDef,const YDAccount *pAccount=NULL)=0

组合持仓或拆开组合持仓。如果无法发送则返回false，说明发生了网络断链。

如果被ydServer拒绝，则通过YDListener::notifyFailedCombPositionOrder回调，如果到了交易所，则通过YDListener::notifyCombPositionOrder回调获得。

### insertOptionExecTogetherOrder

    virtual bool insertOptionExecTogetherOrder(YDInputOrder *pInputOrder,const YDInstrument *pInstrument,const YDInstrument *pInstrument2,const YDAccount *pAccount)=0

合并行权。如果无法发送则返回false，说明发生了网络断链。

如果被ydServer拒绝，则通过YDListener::notifyFailedOptionExecTogetherOrder回调，如果到了交易所，则通过YDListener::notifyOptionExecTogetherOrder回调获得。

### insertMultiOrders

    virtual bool insertMultiOrders(unsigned count, YDInputOrder inputOrders[],const YDInstrument *instruments[], const YDAccount *pAccount=NULL);

count为报单数量，最多16个。批量发出的报单可以批量撤单，也可以单独撤单。

如果报单全部发送成功返回true；部分或全部发送失败返回false。

### cancelMultiOrders

    virtual bool cancelMultiOrders(unsigned count, YDCancelOrder cancelOrders[],const YDExchange *exchanges[], const YDAccount *pAccount=NULL);

count为报单数量，最多16个。

如果撤单请求全部发送成功返回true；部分或全部失败返回false

### insertMultiQuotes

    virtual bool insertMultiQuotes(unsigned count, YDInputQuote inputQuotes[],const YDInstrument *instruments[], const YDAccount *pAccount=NULL)=0;

count为报价数量，最多16个。批量发出的报价可以批量撤单，也可以单独撤单。

如果报价全部发送成功返回true；部分或全部发送失败返回false。

### cancelMultiQuotes

    virtual bool cancelMultiQuotes(unsigned count, YDCancelQuote cancelQuotes[],const YDExchange *exchanges[], const YDAccount *pAccount=NULL)=0;

count为报价数量，最多16个。

如果撤销报价请求全部发送成功返回true；部分或全部失败返回false

### subscribe

    virtual bool subscribe(const YDInstrument *pInstrument)=0;

根据ydServer的配置文件，ydServer可以将接收到的交易所行情以TCP或者UDP组播方式转发给客户端程序

客户端在初始化完成（YDListener::notifyFinishInit）后可以使用YDApi::subscribe方法订阅指定合约的行情。送入不同合约即可订阅多个合约的行情。客户端运行中如果发生网络断链，一旦重新连通网络，原有的订阅仍然有效，无需重新提交, 将自动收到最新行情。

合约行情订阅后，将会通过YDListener::notifyMarketData()方法收到行情。如果客户端配置文件中指定了同时接收TCP和UDP组播行情，则ydApi会归并行情，同一行情客户端仅会收到一次通知。

如果无法网络发送则返回false，说明发生了网络断链。

不提供历史行情订阅功能。

### unsubscribe

    virtual bool unsubscribe(const YDInstrument *pInstrument)=0;

向ydApi/ydServer发送退订行情请求。如果无法网络发送则返回false，说明发生了网络断链。退订后将不再收到该合约的YDListerner::notifyMarket回调。

### setTradingRight

    virtual bool setTradingRight(const YDAccount *pAccount, const YDInstrument *pInstrument, const YDProduct *pProduct, const YDExchange *pExchange, int tradingRight)=0;

仅供管理员使用接口。

本段内容为递进逻辑。如果设置了pInstrument，则pProduct和pExchange无意义，填入NULL，设置账户在此合约的交易权限；如果不设置pInstrument字段，填入NULL。如果设置了pProduct，则pInstrument和pExchange无意义，填入NULL，设置账户在此产品的交易权限；如果不设置pProduct字段，填入NULL。如果设置了pExchange，则pInstrument和pProduct无意义，填入NULL，设置账户在此交易所的交易权限；如果不设置pExchange，填入NULL。

系统缺省允许账户交易，也就是说如果不设置YD\_TR\_CloseOnly和YD\_TR\_Forbidden，即使不设置YD\_TR\_Allow，ydServer也允许此账户交易。不管如何设置，ydServer总是允许客户删除自己的报单。ydServer检查权限时是按照账号、合约、产品和交易所的顺序依次检查，只要一项不允许交易，客户则不能报单；只要其中一项不允许开仓，客户则只能平仓。

如果无法网络发送则返回false，说明发生了网络断链。ydServer的处理结果通过YDListener::notifyAccount系列回调函数返回。notifyAccount代表账号级别；notifyAccountExchangeInfo代表交易所级别；notifyAccountProductInfo代表产品级别；notifyAccountInstrumentInfo代表合约级别。若所修改的账号正在连线ydServer，也将收到上述回报信息。

### alterMoney

    virtual bool alterMoney(const YDAccount *pAccount, int alterMoneyType, double alterValue)=0;

仅供管理员使用接口,设置账号资金。

如果无法网络发送则返回false，说明发生了网络断链。ydServer的处理结果通过YDLisener::notifyAccount回调函数获得。若所修改的账号正在连线ydServer，也将收到上述回报信息。

### updateMarginRate

    virtual bool updateMarginRate(const YDUpdateMarginRate *pUpdateMarginRate)=0;

仅供管理员使用接口,设置账号保证金率。

如果无法发送则返回false，说明发生了网络断链。ydServer的处理结果通过YDLisener::notifyUpdateMarginRate回调获得。若所修改的账号正在连线ydServer，也将收到上述回报信息。

### changePassword

    virtual bool changePassword(const char *username, const char *oldPassword, const char *newPassword)=0;

修改用户口令。普通用户可以修改自身口令。管理员可以修改自身和普通用户口令，管理员修改普通用户口令时oldPassword设置为NULL。

如果无法网络发送则返回false，说明发生了网络断链。ydServer的处理结果通过YDLisener::notifyChangePassword回调函数的参数errorNo获得。

### selectConnections

    virtual bool selectConnections(const YDExchange *pExchange,unsigned long long connectionList)=0

向柜台发布席位优选的结果，当柜台收到使用YD\_CS\_Any的报单时，将使用席位优选结果进行报单。

该方法只能由管理员或具有YD\_AF\_SelectConnection标志的帐户使用。connectionList为4bit的列表，最低的位具有最高优先级，必须覆盖指定交换的所有连接。

例如，要设置由快到慢的前置的顺序为2-3-0-1-4，那么connectionList的二进制位表示为：0100 0001 0000 0011 0010

### hasFinishedInit

    virtual bool hasFinishedInit(void)=0;

判断ydApi是否接收了完整的ydServer推送的初始化数据。如果返回true，则初始数据接收完成，可以安全使用初始数据和自定义字段。

### getSystemParam

    
    virtual int getSystemParamCount(void);
    virtual const YDSystemParam *getSystemParam(int pos);
    virtual const YDSystemParam *getSystemParamByName(const char *name,const char *target);
    

获取系统参数。

### getExchange

    //获取ydServer连接的交易所数量
    virtual int getExchangeCount(void)=0;
    //获取指定位置pos的交易所信息，pos从0开始编号，最大值为getExchangeCount()-1；
    virtual const YDExchange *getExchange(int pos)=0;
    //通过交易所编码，比如”CFFEX”/”SHFE”，获取交易所信息
    virtual const YDExchange *getExchangeByID(const char *exchangeID)=0;

获取交易所基础信息，其中包括席位连接数和交易所风控和流控信息。

### getProduct

    //获取产品数量
    virtual int getProductCount(void)=0;
    //获取指定位置pos的产品信息，pos从0开始编号，最大值为getProductCount()-1；
    virtual const YDProduct *getProduct(int pos)=0;
    //通过产品编码，获取产品信息
    virtual const YDProduct *getProductByID(const char *productID)=0;

获取产品信息。

### getInstrument

    //获取合约数量
    virtual int getInstrumentCount(void)=0;
    //获取指定位置pos的合约信息，pos从0开始编号，最大值为getInstrumentCount()-1；
    virtual const YDInstrument *getInstrument(int pos)=0;
    //通过合约编码，获取合约信息
    virtual const YDInstrument *getInstrumentByID(const char *instrumentID)=0;

获取合约信息。

### getCombPositionDef

    //获取合约数量
    virtual int getCombPositionDefCount(void)=0;
    virtual const YDCombPositionDef *getCombPositionDef(int pos)=0;
    virtual const YDCombPositionDef *getCombPositionDefByID(const char *combPositionID,int combHedgeFlag)=0;

获取组合持仓定义信息。

### getAccount

    //获取账号数量
    virtual int getAccountCount(void)=0;
    //获取指定位置pos的账号信息，pos从0开始编号，最大值为getAccountCount()-1；
    virtual const YDAccount *getAccount(int pos)=0;
    //通过账号编码，获取账号信息
    virtual const YDAccount *getAccountByID(const char *accountID)=0;

仅供管理员使用。获取账户层面信息。

普通用户使用以下方法获取账号信息：

    /// following function for YDAccount can only be used by trader
    virtual const YDAccount *getMyAccount(void)=0;

### getPrePosition

    //获取日初持仓记录数量
    virtual int getPrePositionCount(void)=0;
    //获取指定位置pos的日初持仓记录，pos从0开始编号，最大值为getPrePositionCount()-1；
    virtual const YDPrePosition *getPrePosition(int pos)=0;

获取日初持仓数据，该信息是静态数据，同一个交易日不会发生变化。

### getMarginRate

    //获取保证金率记录数量
    virtual int getMarginRateCount(void)=0;
    //获取指定位置pos的记录，pos从0开始编号，最大值为getMarginRateCount()-1；
    virtual const YDMarginRate *getMarginRate(int pos)=0;
    

获取保证金率的设置值，由于层级结构的影响，设置值通常是稀疏的。对于普通用户，在交易中希望获取具体合约的保证金，请使用getAccountInstrumentInfo。

### getCommissionRate

    //获取手续费率记录数量
    virtual int getCommissionRateCount(void)=0;
    //获取指定位置pos的记录，pos从0开始编号，最大值为getCommissionRateRateCount()-1；
    virtual const YDCommissionRate *getCommissionRate(int pos)=0;

获取手续费率的设置值，由于层级结构的影响，设置值通常是稀疏的。对于普通用户，在交易中希望获取具体合约的手续费率，请使用getAccountInstrumentInfo。

### getAccountInfo

    virtual const YDAccountExchangeInfo *getAccountExchangeInfo(const YDExchange *pExchange, const YDAccount *pAccount=NULL)=0;
    virtual const YDAccountProductInfo *getAccountProductInfo(const YDProduct *pProduct, const YDAccount *pAccount=NULL)=0;
    virtual const YDAccountInstrumentInfo *getAccountInstrumentInfo(const YDInstrument *pInstrument, const YDAccount *pAccount=NULL)=0;

获取投资者在交易所、产品和合约层面的保证金率、费率等信息，这些函数保证在每个层面都有设置值，通常情况下，应该使用getAccountInstrumentInfo来获取具体的值。

### getGeneralRiskParam

    //获取通用风控参数数量
    virtual int getGeneralRiskParamCount(void)=0;
    //获取指定位置pos的记录，pos从0开始编号，最大值为getGeneralRiskParamCount()-1；
    virtual const YDGeneralRiskParam *getGeneralRiskParam(int pos)=0;

获取通用参数的设置值。

### writeLog

    virtual void writeLog(const char *format,...)=0;

如果在yd.so（Linux版本）或者yd.dll（Windows版本）的同一路径下存在./log目录，ydApi会记录网络通信的一些关键日志，日志采用syslog格式，日志文件名称为ccyymmddlog.txt。

客户端可以调用writeLog方法在该文件中记录日志。

### getVersion

    virtual const char *getVersion(void)=0

获取当前ydApi的版本，版本由四段版本号构成。

### getClientPacketHeader

    virtual int getClientPacketHeader(YDPacketType type, unsigned char* header, int len) = 0

获取用于裸协议报单时的协议头部。其中YDPacketType可以是YD\_CLIENT\_PACKET\_INSERT\_ORDER或者YD\_CLIENT\_PACKET\_CANCEL\_ORDER。header和len是用户预先创建的存储区域的头指针以及长度，用于容纳api生成的头部数据，len应大于对应类型的头部的长度。本方法只能在notifyFinishInit及其后续步骤中被调用。

返回值表示实际返回的头部长度，目前支持的报单和撤单的协议头部长度都是16。如果返回0，表示获取协议头部失败，通常是因为调用时间点过早，或者没有开通使用协议报单功能的权限。

### getTradingDay

    virtual int getTradingDay(void)=0;

在成功登录以后，可以获得当前的交易日。

YDExtendedListener
------------------

### notifyExtendedOrder

    virtual void notifyExtendedOrder(const YDExtendedOrder *pOrder)

返回YDExtendedOrder。

### notifyExtendedTrade

    virtual void notifyExtendedTrade(const YDExtendedTrade *pTrade)

YDExtendedTrade。

### notifyExtendedQuote

    virtual void notifyExtendedQuote(const YDExtendedQuote *pQuote)

返回YDExtendedQuote。

### notifyExtendedPosition

    virtual void notifyExtendedPosition(const YDExtendedPosition *pPosition)

当持仓有任何的变化时，如保证金发生改变，持仓量发生改变，都会返回YDExtendedPosition。

### notifyExtendedAccount

    virtual void notifyExtendedAccount(const YDExtendedAccount *pAccount)

当账户有任何的变化时，如可用资金发生改变和出入金时，都会返回YDExtendedAccount。

### notifyExchangeCombPositionDetail

    virtual void notifyExchangeCombPositionDetail(const YDExtendedCombPositionDetail *pCombPositionDetail)

只有在上交所或者深交所的时候，才会返回YDExtendedCombPositionDetail。

YDExtendedApi
-------------

YDExtendedApi是YDApi的子类，针对需要Api来管钱管仓的用户，提供了报单检验，账户资金、仓位、报单、成交查询等功能。报单检验和管钱管仓可能会对性能有所影响，用户应该根据自己的需要决定是否使用。

### startExtended

    virtual bool startExtended(YDListener *pListener,YDExtendedListener *pExtendedListener)=0;

如果想要收到YDExtendedListener返回的回调，则可以调用本方法启动YDExtendedApi，否则仍然可以使用start来启动api。

### checkAndInsertOrder

    virtual bool checkAndInsertOrder(YDInputOrder *pInputOrder,const YDInstrument *pInstrument, const YDAccount *pAccount=NULL);

insertOrder不检查报单的正确性，在收到回报前也不冻结仓位和资金。

checkAndInsertOrder在发送报单前会检查报单信息的正确性，在检查通过并且发送成功时会冻结仓位和资金。

checkAndInsertOrder会自动使用下一个未使用的值作为本报单的OrderRef，使用者可以在调用完成后从参数pInputOrder中读到这个OrderRef。

报单检查通过并发送成功时返回true；发生错误时会设置参数pInputOrder中的ErrorNo。

### checkOrder

    virtual bool checkOrder(YDInputOrder *pInputOrder,const YDInstrument *pInstrument, const YDAccount *pAccount=NULL);

checkOrder只检查报单的正确性，而不发送报单。报单正确时返回true；报单存在错误的时候返回fasle，并会设置参数pInputOrder中的ErrorNo。

### checkAndInsertMultiOrders

    virtual bool checkAndInsertMultiOrders(unsigned count, YDInputOrder inputOrders[],const YDInstrument *instruments[], const YDAccount *pAccount=NULL);

批量发送报单，每个报单的处理和checkAndInsertOrder相同，只有在所有报单都检查通过后才会发送报单，发送成功时返回true，否则返回false。

批量不能超过16个报单。

### checkAndInsertCombPositionOrder

    virtual bool checkAndInsertCombPositionOrder(YDInputOrder *pInputOrder,const YDCombPositionDef *pCombPositionDef,const YDAccount *pAccount=NULL)=0;

检查并报送组合持仓报单。目前仅支持大商所组合持仓。

### checkCombPositionOrder

    virtual bool checkCombPositionOrder(YDInputOrder *pInputOrder,const YDCombPositionDef *pCombPositionDef,const YDAccount *pAccount=NULL)=0;

只检查组合持仓报单的正确性，而不发送报单。报单正确时返回true；报单存在错误的时候返回fasle，并会设置参数pInputOrder中的ErrorNo。目前仅支持大商所组合持仓。

### checkAndInsertQuote

    virtual bool checkAndInsertQuote(YDInputQuote *pInputQuote,const YDInstrument *pInstrument, const YDAccount *pAccount=NULL)=0;

checkAndInsertQuote在发送报单前会检查报单信息的正确性，在检查通过并且发送成功时会冻结仓位和资金。

checkAndInsertQuote会自动使用下一个未使用的值作为本报单的OrderRef，使用者可以在调用完成后从参数pInputQuote中读到这个OrderRef。

报单检查通过并发送成功时返回true；发生错误时会设置参数pInputQuote中的ErrorNo。

### checkQuote

    virtual bool checkQuote(YDInputQuote *pInputQuote,const YDInstrument *pInstrument, const YDAccount *pAccount=NULL)=0;

checkQuote只检查报价的正确性，而不发送报价。报价正确时返回true；报价存在错误的时候返回fasle，并会设置参数pInputQuote中的ErrorNo。

### getExtendedAccount

    virtual const YDExtendedAccount *getExtendedAccount(const YDAccount *pAccount=NULL)；

获取扩展账户信息，扩展账户信息结构参见YDExtendedAccount

### getExtendedPosition

    virtual const YDExtendedPosition *getExtendedPosition(int positionDate,int positionDirection,int hedgeFlag, const YDInstrument *pInstrument,const YDAccount *pAccount=NULL,bool create=false);

根据参数给定条件获取单个扩展持仓信息，参见扩展持仓信息结构YDExtendedPosition

返回的YDExtendedPosition中有Position和YDPositionForCommission两个关于持仓量的字段，对于不同的持仓日期（positionDate）和交易所，其含义如下所示。

**positionDate**

**YD\_PSD\_Today**

**YD\_PSD\_History**

**仓位字段**

**Position**

**YDPosition  
ForCommission**

**Position**

**YDPosition  
ForCommission**

**SHFE/INE**

今仓

无意义

剩余昨仓

无意义

**DCE**

无意义

无意义

总持仓

剩余昨仓

**CFFEX**

无意义

无意义

总持仓

剩余昨仓

### findExtendedPositions

    virtual unsigned findExtendedPositions(const YDExtendedPositionFilter *pFilter, unsigned count, const YDExtendedPosition *positions[]);

根据参数给定的过滤条件获取满足条件的扩展持仓信息，过滤条件的设置方法参见YDExtendedPositionFilter。

方法返回值是结果的总数。查询结果保存在参数positions中，参数count是positions数组的长度。在结果总数多于count时，positions只会保存count个结果。

### recalcMarginAndPositionProfit

    virtual void recalcMarginAndPositionProfit(void)=0;

计算保证金和持仓盈亏。

只有当配置文件中的RecalcMode为subscribeOnly时需要手工调用。

### getInstrumentMarginRate

    virtual const YDMarginRate *getInstrumentMarginRate(const YDInstrument *pInstrument,int hedgeFlag,const YDAccount *pAccount=NULL)=0;

获取指定账户、合约、套保标志的保证金率信息。

### getInstrumentCommissionRate

    virtual const YDCommissionRate *getInstrumentCommissionRate(const YDInstrument *pInstrument,int hedgeFlag,const YDAccount *pAccount=NULL)=0;

获取指定账户、合约、套保标志的手续费率。

### getOrder

    virtual const YDExtendedOrder *getOrder(int orderRef,const YDAccount *pAccount);
    virtual const YDExtendedOrder *getOrder(int orderSysID,const YDExchange *pExchange)=0;
    

通过OrderRef或OrderSysID查询报单，注意只有通过checkAndInsertOrder和checkAndInsertMultiOrders发出的报单才可以通过这个方法查询到。

### findOrders

    virtual unsigned findOrders(const YDOrderFilter *pFilter,unsigned count,const YDExtendedOrder *orders[]);

根据参数给定的过滤条件获取满足条件的报单信息。

方法返回值是结果的总数。查询结果保存在参数orders中。参数count是orders数组的长度。在结果总数多于count时，orders只会保存count个结果。

### getQuote

    virtual const YDExtendedQuote *getQuote(int orderRef,const YDAccount *pAccount)=0;
    virtual const YDExtendedQuote *getQuote(int quoteSysID,const YDExchange *pExchange)=0;

通过报价的OrderRef或者QuoteSysID查询报价。

### findQuotes

    virtual unsigned findQuotes(const YDQuoteFilter *pFilter,unsigned count,const YDExtendedQuote *quotes[])=0;

根据参数给定的过滤条件结构YDQuoteFilter获取满足条件的报价信息。

方法返回值是结果的总数。查询结果保存在参数quotes中。参数count是quotes数组的长度。在结果总数多于count时，quotes只会保存count个结果。

### findTrades

    virtual unsigned findTrades(const YDTradeFilter *pFilter,unsigned count,const YDExtendedTrade *trades[]);

根据参数给定的过滤条件获取满足条件的成交信息。

方法返回值是结果的总数。查询结果保存在参数trades中，参数count是trades数组的长度。在结果总数多于count时，trades只会保存count个结果。

### getCombPositionDetail

    virtual const YDExtendedCombPositionDetail *getCombPositionDetail(int combPositionDetailID)=0;

通过组合持仓明细ID，查询组合持仓明细信息。

注意，此函数只适用于上交所和深交所。

### findCombPositionDetails

    virtual unsigned findCombPositionDetails(const YDCombPositionDetailFilter *pFilter,unsigned count,const YDExtendedCombPositionDetail *combPositionDetails[])=0;

根据参数给定的过滤条件结构YDCombPositionDetailFilter获取满足条件的组合持仓明细信息。

方法返回值是结果的总数。查询结果保存在参数combPositionDetails中。参数count是combPositionDetails数组的长度。在结果总数多于count时，combPositionDetails只会保存count个结果。

注意，此函数只适用于上交所和深交所。

### getIDFromExchange

    virtual const char *getIDFromExchange(const YDExchange *pExchange,int idType,int idInSystem)=0;

通过易达的系统ID，查询从交易所获取的初始ID信息。

### getOptionsShortMarginPerLot

    virtual double getOptionsShortMarginPerLot(const YDInstrument *pInstrument,int hedgeFlag,bool includePremium,const YDAccount *pAccount=NULL)=0;

根据账户、合约、投保标志的组合获得期权卖方每手的保证金。

当includePremium为true时，保证金中将加上权利金一并返回。

### getRequestForQuote

    virtual const YDExtendedRequestForQuote *getRequestForQuote(const YDInstrument *pInstrument)=0;

获得当前用户的某一合约的报价请求。

### autoCreateCombPosition

    virtual const YDCombPositionDef* autoCreateCombPosition(const int *combTypes)=0

自动搜索和并组合当前持仓中可被组合的持仓。

combTypes可以按顺序指定需要被组合的类型，组合程序将按照combTypes数组中指定的类型顺序逐一检查和组合，combTypes应该以-1结尾，如果combTypes为NULL，则会检查并组合所有的类型。

每次调用autoCreateCombPosition只会搜索一腿组合持仓，找到后向大商所发送组合指令，发送指令的OrderRef始终为0。如果组合成功将返回该组合的定义，并将调整保证金和可用资金；如果返回NULL则表示本次没有找到可以被组合的持仓或者组合失败。

由于易达并不冻结组合持仓，因为如果发送间隔小于组合指令往返和处理的时间，会导致后续发送的指令失败或者重复组合，因此，至少需要在notifyCombPositionOrder里面返回上一次组合的结果后，才可以开始下一次调用。

ydUtil
======

string2TimeID
-------------

    inline unsigned string2TimeID(const char *timeBuffer)
    {
        if (*timeBuffer=='\0')
        {
            return 0;
        }
        const int timeAdjust='0'*(36000+3600+600+60+10+1);
        int tmp=(timeBuffer[0]*36000+timeBuffer[1]*3600+timeBuffer[3]*600+timeBuffer[4]*60+timeBuffer[6]*10+timeBuffer[7]);
        if (tmp>START_HOUR*3600+timeAdjust)
        {
            tmp-=START_HOUR*3600+timeAdjust;
        }
        else
        {
            tmp+=(24-START_HOUR)*3600-timeAdjust;
        }
        return tmp;
    }

把形如HH24:MI:SS的时间格式转化为易达内部的秒级时间格式。易达内部的秒级时间格式是距离17:00:00的秒数。

timeID2String
-------------

    inline const char *timeID2String(unsigned timeID, char *buffer)
    {
        if ((int)timeID<=0)
        {
            return "";
        }
        sprintf(buffer,"%02d:%02d:%02d",(timeID/3600+START_HOUR)%24,timeID/60%60,timeID%60);
        return buffer;
    }

把易达内部的秒级时间格式转化为形如HH24:MI:SS的时间格式。易达内部的秒级时间格式是距离17:00:00的秒数。

timeStamp2String
----------------

    inline const char *timeStamp2String(unsigned timestamp,char *buffer)
    {
        if (timestamp==0)
        {
            return "";
        }
        timeID2String(timestamp/1000,buffer);
        sprintf(buffer+8,".%03d",timestamp%1000);
        return buffer;
    }

把易达内部的毫秒级时间格式转化为形如HH24:MI:SS.millisec的时间格式。易达内部的秒级时间格式是距离17:00:00.000的毫秒数。

dump系列
------

    inline void dumpField(FILE *output,int value)
    inline void dumpField(FILE *output,unsigned value)
    inline void dumpField(FILE *output,short value)
    inline void dumpField(FILE *output,unsigned short value)
    inline void dumpField(FILE *output,char value)
    inline void dumpField(FILE *output,unsigned char value)
    inline void dumpField(FILE *output,unsigned long long value)
    inline void dumpField(FILE *output,long long value)
    inline void dumpField(FILE *output,bool value)
    inline void dumpField(FILE *output,double value)
    inline void dumpField(FILE *output,const char *value)
    inline void dumpTimeField(FILE *output,int value)
    inline void dumpTimeStampField(FILE *output,int value)

把不同类型的字段值写入文件，帮助调试使用。